<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabji Haat - Fresh Vegetables</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: white;
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        /* ========== HEADER ========== */
        header {
            background-color: white;
            padding: 10px 12px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #eee;
        }
        
        nav {
            display: flex;
            justify-content: center;
            gap: 30px;
        }
        
        nav a {
            color: black;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            padding: 8px 15px;
            transition: all 0.3s ease;
            border-radius: 4px;
        }
        
        nav a:hover {
            background-color: #f5f5f5;
        }
        
        /* ========== HERO SECTION ========== */
        .hero-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
        }
        
        .hero-image {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .hero-image img {
            width: 100%;
            height: auto;
            max-height: 200px;
            object-fit: contain;
            display: block;
        }
        
        .offer-banner {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            color: white;
            padding: 12px 15px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            width: 100%;
        }
        
        .icons-container {
            background-color: white;
            padding: 15px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .icon {
            font-size: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .whatsapp { color: #25D366; }
        .facebook { color: #1877F2; }
        .instagram { color: #E4405F; }
        .review { color: #FFA500; }
        .cart { color: #007BFF; }
        
        .icon:hover {
            transform: scale(1.1);
        }
        
        /* ========== SERVICES SECTION ========== */
        .services-section {
            background: linear-gradient(135deg, #8d6e63, #5d4037);
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
            overflow: hidden;
        }

        .services-title {
            text-align: center;
            color: white;
            font-size: 16px;
            margin-bottom: 5px;
            font-weight: bold;
            padding: 0 15px;
        }

        .services-subtitle {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            margin-bottom: 10px;
            padding: 0 15px;
        }

        .services-container-wrapper {
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 130px;
        }

        .services-container {
            display: flex;
            height: 100%;
            transition: transform 0.5s ease-in-out;
            width: 100%;
        }

        .service-card {
            flex: 0 0 calc(33.33% - 10px);
            background: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 0 5px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .service-image {
            width: 100%;
            height: 80px;
            object-fit: cover;
            display: block;
        }

        .service-name {
            padding: 5px;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            color: #5d4037;
            background: transparent;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mission-image {
    width: 100%;
    padding: 15px;
    background: white;
    border-top: 1px solid #f0f0f0;
    border-bottom: 1px solid #f0f0f0;
    text-align: center;
}

.mission-image img {
    width: 100%;
    max-width: 380px;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: block;
    margin: 0 auto;
}

        /* Navigation arrows */
        .services-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            opacity: 0.8;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .services-nav:hover {
            background: white;
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }

        .services-nav.prev { left: 5px; }
        .services-nav.next { right: 5px; }

        /* Dots indicator */
        .services-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            padding: 0 15px;
        }

        .services-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .services-dot.active {
            background: white;
            transform: scale(1.2);
        }
        
        /* ========== SEARCH ========== */
        .search-container {
            padding: 15px;
            background-color: white;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }
        
        .search-bar {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .search-bar:focus {
            border-color: #007BFF;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
        }
        
        .search-icon {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            cursor: pointer;
        }
        
        /* ========== CATEGORY SECTION/* ========== CATEGORY SECTION - FIXED ========== */
.category-section {
    background: linear-gradient(135deg, #4CAF50, #2E7D32);
    border-bottom: 1px solid #f0f0f0;
    padding: 15px 10px;
    border-radius: 12px;
    margin: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.category-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    gap: 5px;
}

.category-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    min-width: 0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.category-item:hover {
    transform: translateY(-5px);
}

.category-image-wrapper {
    width: 55px;
    height: 55px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid #fdf900;
    transition: all 0.3s ease;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
    margin-bottom: 8px;
}

.category-image-wrapper.active {
    border-color: #fb1302;
    box-shadow: 0 0 12px rgba(251, 19, 2, 0.7);
    transform: scale(1.05);
}

.category-image-wrapper:hover {
    transform: scale(1.08);
    border-color: #fb1302;
}

.category-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.category-btn {
    background: linear-gradient(135deg, #26734d, #2E7D32);
    color: white;
    border: none;
    padding: 6px 8px;
    border-radius: 15px;
    font-weight: bold;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    max-width: 70px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.category-btn.active, .category-btn:hover {
    background: linear-gradient(135deg, #fdf900, #ffeb3b);
    color: #fb1302;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* Responsive adjustments */
@media (max-width: 414px) {
    .category-row {
        gap: 3px;
    }
    
    .category-image-wrapper {
        width: 50px;
        height: 50px;
    }
    
    .category-btn {
        font-size: 10px;
        padding: 5px 6px;
        max-width: 60px;
    }
}

@media (max-width: 360px) {
    .category-image-wrapper {
        width: 45px;
        height: 45px;
    }
    
    .category-btn {
        font-size: 9px;
        padding: 4px 5px;
        max-width: 55px;
    }
}
        
        /* ========== PRODUCTS ========== */
        .products-container {
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            background: linear-gradient(135deg, #e8f5e9, #ffffff);
            min-height: 300px;
        }
        
        .product-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255,255,255,0.3);
            position: relative;
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .product-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
        
        .product-info {
            padding: 10px;
        }
        
        .product-name {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
            height: 40px;
            overflow: hidden;
        }
        
        .product-price {
            color: #e74c3c;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .quantity-selector {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .quantity-options {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        
        .quantity-option {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quantity-option:hover, .quantity-option.active {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .custom-quantity {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }
        
        .custom-quantity-input {
            width: 60px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }
        
        .add-to-cart {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
        }
        
        .add-to-cart:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
        }
        
        .add-to-cart:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            z-index: 5;
        }
        
        .out-of-stock {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #e74c3c;
            font-size: 14px;
            z-index: 2;
        }
           /* ========== STICKY CART ========== */
        .sticky-cart-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .sticky-cart-btn:hover {
            transform: scale(1.1);
        }
        
        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #fdf900;
            color: #e74c3c;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* ========== REVIEWS SECTION ========== */
        .reviews-section {
            background: linear-gradient(135deg, #e8f5e9, #ffffff);
            padding: 30px 10px;
            text-align: center;
            overflow: hidden;
        }
        
        .review-title {
            color: #2e7d32;
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .review-container-wrapper {
            position: relative;
            overflow: hidden;
            width: 100%;
            margin-bottom: 20px;
            height: 180px;
        }
        
        .review-container {
            display: flex;
            transition: transform 0.5s ease-in-out;
            width: 100%;
            height: 100%;
        }
        
        .review-card {
            flex: 0 0 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            padding: 15px;
            text-align: left;
            margin: 0 10px;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out forwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .review-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }
        
        .review-card p {
            font-size: 14px;
            color: #444;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        
        .review-card h4 {
            color: #2e7d32;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .stars {
            color: gold;
            font-size: 16px;
            margin-top: 5px;
        }
        
        /* Review navigation */
        .review-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            opacity: 0.8;
        }
        
        .review-nav:hover {
            background: white;
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
        }
        
        .review-nav.prev { left: 5px; }
        .review-nav.next { right: 5px; }
        
        /* Counter + Review Button */
        .review-stats {
            margin-top: 30px;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        
        .counter {
            font-size: 26px;
            color: #2e7d32;
            font-weight: 700;
            text-align: center;
            animation: countUp 2s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes countUp {
            to { opacity: 1; transform: translateY(0); }
        }
        
        .counter p {
            font-size: 14px;
            color: #444;
            margin: 5px 0 0;
        }
        
        .review-btn {
            background: linear-gradient(135deg, #43a047, #1b5e20);
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            cursor: pointer;
            transition: 0.3s ease;
        }
        
        .review-btn:hover {
            transform: scale(1.05);
        }
        

        
        /* ========== MODALS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        /* ========== ABOUT PAGE ========== */
        .about-page {
            display: none;
            padding: 20px;
            background-color: white;
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }
        
        .about-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .about-title {
            font-size: 24px;
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .about-image {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .about-content {
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .about-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .feature-card {
            background: #f5f9f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #4CAF50;
        }
        
        .back-to-home {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        
        /* ========== ADMIN PANEL ========== */
        .admin-panel {
            display: none;
            padding: 20px;
            background-color: white;
            max-width: 414px;
            margin: 0 auto;
            min-height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1001;
        }
        
        .admin-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .admin-title {
            font-size: 24px;
            color: #2e7d32;
        }
        
        .admin-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .admin-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
        }
        
        .admin-tab.active {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        /* ========== FOOTER ========== */
        footer {
            background-color: #f9f9f9;
            padding: 10px 15px;
            text-align: center;
            font-size: 14px;
            color: #666;
            border-top: 1px solid #eee;
        }
        
        /* ========== NOTIFICATION ========== */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2ecc71;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 4000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        /* ========== LOADING ========== */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 414px) {
            .product-card {
                animation-delay: calc(var(--i) * 0.1s);
            }
        }
    </style>
</head>
<body>
    <!-- Main App -->
    <div class="main-app">
        <header>
            <nav>
                <a href="#" class="nav-home" id="homeButton">HOME</a>
                <a href="#" class="nav-about" onclick="showAboutPage()">ABOUT US</a>
            </nav>
        </header>
        
        <div class="hero-section">
            <div class="hero-image">
                <img src="Hero.jpg" alt="Fresh Vegetables">
            </div>
            <div class="offer-banner" id="offerBanner">
                üìû For Bulk Orders at Wholesale Rate : +919051410591
            </div>
            
            <div class="icons-container">
                <i class="icon whatsapp fab fa-whatsapp" onclick="openWhatsApp()"></i>
                <i class="icon facebook fab fa-facebook" onclick="openFacebook()"></i>
                <i class="icon instagram fab fa-instagram" onclick="openInstagram()"></i>
                <i class="icon review fas fa-star" onclick="openGoogleReview()"></i>
                <i class="icon cart fas fa-shopping-cart" onclick="openCart()"></i>
            </div>
        </div>
        
        <!-- Services Section -->
        <div class="services-section">
            <h3 class="services-title">Our Special Services</h3>
            <p class="services-subtitle">Click any service to contact owner directly via WhatsApp</p>
            <div class="services-container-wrapper">
                <button class="services-nav prev" onclick="slideServices('prev')">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="services-container" id="servicesContainer">
                    <div class="service-card" onclick="openServiceWhatsApp('Restaurant Orders')">
                        <img src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Restaurant Orders" class="service-image">
                        <div class="service-name">Restaurant Orders</div>
                    </div>
                    <div class="service-card" onclick="openServiceWhatsApp('Catering Orders')">
                        <img src="https://images.unsplash.com/photo-1555244162-803834f70033?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Catering Orders" class="service-image">
                        <div class="service-name">Catering Orders</div>
                    </div>
                    <div class="service-card" onclick="openServiceWhatsApp('Special Occasions')">
                        <img src="https://cdn.pixabay.com/photo/2023/11/03/16/19/celebration-8363367_1280.jpg" alt="Special Occasions" class="service-image">
                        <div class="service-name">Special Occasions</div>
                    </div>
                    <div class="service-card" onclick="openServiceWhatsApp('Bulk Orders')">
                        <img src="https://plus.unsplash.com/premium_photo-1686529896385-8a8d581d0225?ixlib=rb-4.1.0&auto=format&fit=crop&q=60&w=600" alt="Bulk Orders" class="service-image">
                        <div class="service-name">Bulk Orders</div>
                    </div>
                    <div class="service-card" onclick="openServiceWhatsApp('Wholesale Price')">
                        <img src="wholesaler.jpg" alt="Wholesale Price" class="service-image">
                        <div class="service-name">Wholesale Price</div>
                    </div>
                 <div class="service-card" onclick="openServiceWhatsApp('Wholesale Price')">
                        <img src="fixed.jpg" alt="Wholesale Price" class="service-image">
                        <div class="service-name">Fixed Price</div>
                </div>
                </div>
                <button class="services-nav next" onclick="slideServices('next')">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="services-dots" id="servicesDots"></div>
        </div>
        
        <!-- Search -->
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search products..." id="searchInput">
            <i class="search-icon fas fa-search" id="searchIcon"></i>
        </div>
<!-- Category Section - FIXED VERSION -->
<div class="category-section">
    <div class="category-row">
        <!-- Category 1: Indian -->
        <div class="category-item" onclick="loadCategory('indian')">
            <div class="category-image-wrapper active" data-category="indian">
                <img src="indian.jpg" 
                     alt="Indian Vegetables" class="category-image">
            </div>
            <button class="category-btn active" data-category="indian">Indian</button>
        </div>
        
        <!-- Category 2: Exotic -->
        <div class="category-item" onclick="loadCategory('exotic')">
            <div class="category-image-wrapper" data-category="exotic">
                <img src= "exotic.jpg" 
                     alt="Exotic Vegetables" class="category-image">
            </div>
            <button class="category-btn" data-category="exotic">Exotic</button>
        </div>
        
        <!-- Category 3: Leafy -->
        <div class="category-item" onclick="loadCategory('leafy')">
            <div class="category-image-wrapper" data-category="leafy">
                <img src="spinach.jpg" 
                     alt="Leafy Vegetables" class="category-image">
            </div>
            <button class="category-btn" data-category="leafy">Leafy</button>
        </div>
        
        <!-- Category 4: Others -->
        <div class="category-item" onclick="loadCategory('others')">
            <div class="category-image-wrapper" data-category="others">
                <img src="panner-image.jpg" 
                     alt="Other Products" class="category-image">
            </div>
            <button class="category-btn" data-category="others">Others</button>
        </div>
        
        <!-- Category 5: Puja -->
        <div class="category-item" onclick="loadCategory('puja')">
            <div class="category-image-wrapper" data-category="puja">
                <img src="https://img.freepik.com/premium-photo/copper-kalash-with-coconut-mango-leaf-with-floral-decoration-diya-haldi-kumkum-sweet-pedha-essential-hindu-puja-front-view-closeup-red-surface_466689-47208.jpg?semt=ais_hybrid&w=740&q=80" 
                     alt="Puja Needs" class="category-image">
            </div>
            <button class="category-btn" data-category="puja">Puja</button>
        </div>
    </div>
</div>
        
        <!-- Products Container -->
        <div class="products-container" id="productsContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading products...</p>
            </div>
        </div>
        
        <!-- Mission Image -->
        <div class="mission-image">
            <img src="mission.jpg" alt="Our Mission">
        </div>
        
        <!-- Sticky Cart Button -->
        <button class="sticky-cart-btn" onclick="openCart()">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cartCount">0</span>
        </button>
        
        <!-- Reviews Section -->
        <section class="reviews-section">
            <h2 class="review-title">üíö What Our Customers Say</h2>
            <div class="review-container-wrapper">
                <button class="review-nav prev" onclick="slideReviews('prev')">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="review-container" id="reviewContainer">
                    <div class="review-card">
                        <p>"Best place to buy fresh vegetables ‚Äî quality is always top-notch!"</p>
                        <h4>‚Äî Arjun</h4>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="review-card">
                        <p>"Timely pickup every morning! The bulk orders are handled very professionally."</p>
                        <h4>‚Äî Suman</h4>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="review-card">
                        <p>"Fresh vegetables every morning! SabjiHaat has made my home cooking so much easier."</p>
                        <h4>‚Äî Anjali Das</h4>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="review-card">
                        <p>"Amazing freshness and great pricing ‚Äî SabjiHaat has made my daily shopping easy!"</p>
                        <h4>‚Äî Neha Sharma</h4>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="review-card">
                        <p>"Reliable and honest service. Vegetables are always clean and well packed."</p>
                        <h4>‚Äî Rajesh Kumar</h4>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="review-card">
                        <p>"As a restaurant owner, I save both time and money. Highly recommend SabjiHaat!"</p>
                        <h4>‚Äî Priya Singh</h4>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                </div>
                <button class="review-nav next" onclick="slideReviews('next')">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="review-stats">
                <div class="counter">
                    <span id="happyCount">0</span>+
                    <p>Happy Customers</p>
                </div>
                <button class="review-btn" onclick="openGoogleReview()">
                    ‚≠ê Leave a Google Review
                </button>
            </div>
        </section>
        
        
            
                      
                
                
                        
        </section>
        
        <footer>
            <p>¬© 2025 SabjiHaat. All rights reserved.</p>
            <p>Jadavpur Sandhya Bazar Rd, West Bengal Kolkata-700075</p>
        </footer>
    </div>
    
    <!-- About Us Page -->
    <div class="about-page" id="aboutPage">
        <div class="about-header">
            <h1 class="about-title">About Sabji Haat</h1>
            <img src="https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" alt="About Sabji Haat" class="about-image">
        </div>
        <div class="about-content">
            <p>Welcome to Sabji Haat, your trusted partner for fresh, high-quality vegetables available for pickup at our store. Established in 2020, we've been serving the Kolkata community with the freshest produce sourced directly from local farmers.</p>
            <p>Our mission is simple: to provide fresh, healthy, and affordable vegetables while supporting local agriculture and reducing food waste.</p>
            <h3>Why Choose Sabji Haat?</h3>
            <div class="about-features">
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-leaf"></i></div>
                    <div class="feature-title">Farm Fresh</div>
                    <p>Direct from farms to your kitchen</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-store"></i></div>
                    <div class="feature-title">Easy Pickup</div>
                    <p>Convenient store pickup available</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-rupee-sign"></i></div>
                    <div class="feature-title">Best Prices</div>
                    <p>Competitive pricing guaranteed</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-award"></i></div>
                    <div class="feature-title">Quality Assured</div>
                    <p>Rigorous quality checks</p>
                </div>
            </div>
            <div class="payment-highlight">
                ‚ö†Ô∏è Your order will be confirmed only after 50% advance payment
            </div>
        </div>
        <button class="back-to-home" onclick="showHomePage()">Back to Home</button>
    </div>
    
    <!-- Admin Login Modal -->
    <div class="modal" id="adminLoginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Admin Login</h2>
                <button class="close-modal" onclick="closeAdminLogin()">√ó</button>
            </div>
            <form id="adminLoginForm" onsubmit="adminLogin(event)">
                <div style="margin-bottom: 15px;">
                    <input type="text" id="adminUsername" placeholder="Username" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <input type="password" id="adminPassword" placeholder="Password" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <button type="submit" style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer;">
                    Login
                </button>
            </form>
            <button onclick="closeAdminLogin()" style="background: #95a5a6; color: white; border: none; padding: 10px; border-radius: 8px; width: 100%; margin-top: 10px; cursor: pointer;">
                Back to Home
            </button>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h1 class="admin-title">Admin Panel</h1>
            <button onclick="adminLogout()" style="background: #e74c3c; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Logout
            </button>
        </div>
        <div class="admin-tabs">
            <button class="admin-tab active" onclick="switchAdminTab('products')">Products</button>
            <button class="admin-tab" onclick="switchAdminTab('settings')">Settings</button>
            <button class="admin-tab" onclick="switchAdminTab('stock')">Stock</button>
        </div>
        
        <div class="admin-tab-content active" id="productsTab">
            <div style="margin-bottom: 15px;">
                <input type="text" id="adminProductSearch" placeholder="Search products..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;">
                <select id="adminCategoryFilter" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="all">All Categories</option>
                    <option value="indian">Indian</option>
                    <option value="exotic">Exotic</option>
                    <option value="leafy">Leafy</option>
                    <option value="others">Others</option>
                    <option value="puja">Puja Needs</option>
                </select>
            </div>
            <div id="adminProductList" style="max-height: 400px; overflow-y: auto;"></div>
            <button onclick="showAddProductForm()" style="background: #2ecc71; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; margin-top: 15px; cursor: pointer;">
                Add New Product
            </button>
        </div>
        
        <div class="admin-tab-content" id="settingsTab">
            <h3>Store Settings</h3>
            <div style="margin: 15px 0;">
                <label>Packaging Charge (‚Çπ)</label>
                <input type="number" id="packagingCharge" value="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-top: 5px;">
            </div>
            <button onclick="saveSettings()" style="background: #2ecc71; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer;">
                Save Settings
            </button>
        </div>
        
        <div class="admin-tab-content" id="stockTab">
            <h3>Stock Management</h3>
            <div style="margin-bottom: 15px;">
                <input type="text" id="stockSearch" placeholder="Search products..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;">
                <select id="stockCategoryFilter" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="all">All Categories</option>
                    <option value="indian">Indian</option>
                    <option value="exotic">Exotic</option>
                    <option value="leafy">Leafy</option>
                    <option value="others">Others</option>
                    <option value="puja">Puja Needs</option>
                </select>
            </div>
            <div id="stockList" style="max-height: 400px; overflow-y: auto;"></div>
        </div>
        
        <button class="back-to-home" onclick="showHomePage()" style="margin-top: 20px;">Back to Home</button>
    </div>
    
    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Your Cart</h2>
                <button class="close-modal" onclick="closeCart()">√ó</button>
            </div>
            <div id="cartItems" style="margin-bottom: 15px;"></div>
            <div id="cartTotal" style="font-weight: bold; text-align: right; margin: 15px 0; padding-top: 15px; border-top: 1px solid #eee;"></div>
            <div class="payment-highlight">‚ö†Ô∏è Your order will be confirmed only after 50% advance payment</div>
            <button onclick="checkBusinessHours()" style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer;">
                Confirm Order via WhatsApp
            </button>
        </div>
    </div>
    
    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Order Confirmation</h2>
                <button class="close-modal" onclick="closeCheckoutModal()">√ó</button>
            </div>
            <form id="checkoutForm">
                <div style="margin-bottom: 15px;">
                    <label>Full Name *</label>
                    <input type="text" id="customerName" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label>Phone Number *</label>
                    <input type="tel" id="customerPhone" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div class="payment-highlight">‚ö†Ô∏è Your order will be confirmed only after 50% advance payment</div>
                <div id="billingSummary" style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin: 15px 0;"></div>
                <button type="button" onclick="validateAndCheckout()" style="background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; cursor: pointer;">
                    Confirm Order via WhatsApp
                </button>
            </form>
        </div>
    </div>
    
    <!-- Business Hours Modal -->
    <div class="modal" id="businessHoursModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Store Closed</h2>
                <button class="close-modal" onclick="closeBusinessHoursModal()">√ó</button>
            </div>
            <div style="text-align: center; padding: 20px;">
                <p>We're currently closed. Please place your orders between 10:00 AM and 10:00 PM for next day pickup.</p>
                <button onclick="closeBusinessHoursModal()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-top: 15px; cursor: pointer;">
                    OK
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div> 
<script>
    /*\*
    // ==================== CONFIGURATION ====================
    const API_BASE_URL = "https://sabjihaat-backend.onrender.com";
    const BUSINESS_INFO = {
        name: "Sabji Haat",
        phone: "+919051410591",
        address: "Jadavpur Sandhya Bazar Rd, West Bengal Kolkata700075",
        instagram: "https://www.instagram.com/invites/contact/?utm_source=ig_contact_invite&utm_medium=copy_link&utm_content=seyxfz6",
        facebook: "https://www.facebook.com/sabjihaat?mibextid=ZbWKwL",
        googleReview: "https://maps.app.goo.gl/1DNV5UUPp2MXR81fA",
        packagingCharge: 10
    };

    // ==================== GLOBAL STATE ====================
    let PRODUCTS = { indian: [], exotic: [], leafy: [], others: [], puja: [] };
    let cart = [];
    let selectedQuantities = {};
    let currentCategory = 'indian';
    let adminToken = null;
    let servicesCurrentSlide = 0;
    let servicesTotalSlides = 0;
    let reviewsCurrentSlide = 0;
    let reviewsTotalSlides = 5;
    let servicesInterval;
    let reviewsInterval;

    // ==================== INITIALIZE APP ====================
    document.addEventListener('DOMContentLoaded', function() {
        console.log("üöÄ Sabji Haat App Starting...");
        
        // Initialize components
        initServicesSlider();
        initReviewsSlider();
        initCounter();
        setupAdminAccess();
        setupEventListeners();
        
        // Load initial data
        loadAllProducts();
        setTimeout(() => {
            loadCategoryProducts('indian');
        }, 500);
        
        // Initialize first category as active
        setTimeout(() => {
            document.querySelector('.category-item').click();
        }, 1000);
        
        console.log("‚úÖ App Initialized");
    });

    // ==================== CATEGORY FUNCTIONS ====================
    function loadCategory(category) {
        console.log(`Loading category: ${category}`);
        
        // 1. Remove active class from ALL category items
        document.querySelectorAll('.category-image-wrapper').forEach(wrapper => {
            wrapper.classList.remove('active');
        });
        
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // 2. Add active class to SELECTED category
        const selectedImage = document.querySelector(`.category-image-wrapper[data-category="${category}"]`);
        const selectedButton = document.querySelector(`.category-btn[data-category="${category}"]`);
        
        if (selectedImage) {
            selectedImage.classList.add('active');
        }
        
        if (selectedButton) {
            selectedButton.classList.add('active');
        }
        
        // 3. Show loading animation
        const productsContainer = document.getElementById('productsContainer');
        productsContainer.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                <div class="loading-spinner"></div>
                <p>Loading ${category} products...</p>
            </div>
        `;
        
        // 4. Update current category and load products
        currentCategory = category;
        setTimeout(() => {
            loadCategoryProducts(category);
        }, 300);
        
        // Scroll to products section
        setTimeout(() => {
            productsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 400);
    }

    // ==================== EVENT LISTENERS SETUP ====================
    function setupEventListeners() {
        console.log("Setting up event listeners...");
        
        // 1. Category item click events
        document.querySelectorAll('.category-item').forEach(item => {
            item.addEventListener('click', function() {
                const category = this.querySelector('.category-btn').getAttribute('data-category');
                console.log(`Category clicked: ${category}`);
                loadCategory(category);
            });
        });
        
        // 2. Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchIcon = document.getElementById('searchIcon');
        
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim().toLowerCase();
                console.log(`Searching for: ${searchTerm}`);
                filterProducts(searchTerm);
            });
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const searchTerm = this.value.trim().toLowerCase();
                    filterProducts(searchTerm);
                    this.blur();
                }
            });
        }
        
        if (searchIcon) {
            searchIcon.addEventListener('click', function() {
                searchInput.focus();
                searchInput.select();
            });
        }
        
        // 3. Setup modal close events
        setupModalCloseEvents();
        
        console.log("‚úÖ Event listeners setup complete");
    }

    function setupModalCloseEvents() {
        // Cart modal
        const cartModal = document.getElementById('cartModal');
        if (cartModal) {
            cartModal.addEventListener('click', function(e) {
                if (e.target === cartModal) {
                    closeCart();
                }
            });
        }
        
        // Checkout modal
        const checkoutModal = document.getElementById('checkoutModal');
        if (checkoutModal) {
            checkoutModal.addEventListener('click', function(e) {
                if (e.target === checkoutModal) {
                    closeCheckoutModal();
                }
            });
        }
        
        // Admin login modal
        const adminLoginModal = document.getElementById('adminLoginModal');
        if (adminLoginModal) {
            adminLoginModal.addEventListener('click', function(e) {
                if (e.target === adminLoginModal) {
                    closeAdminLogin();
                }
            });
        }
        
        // Business hours modal
        const businessHoursModal = document.getElementById('businessHoursModal');
        if (businessHoursModal) {
            businessHoursModal.addEventListener('click', function(e) {
                if (e.target === businessHoursModal) {
                    closeBusinessHoursModal();
                }
            });
        }
    }

    // ==================== SERVICES SLIDER ====================
    function initServicesSlider() {
        const serviceCards = document.querySelectorAll('.service-card');
        servicesTotalSlides = Math.ceil(serviceCards.length / 3) - 1;
        createServicesDots();
        startServicesAutoSlide();
        
        // Pause on hover
        const servicesContainer = document.getElementById('servicesContainer');
        if (servicesContainer) {
            servicesContainer.addEventListener('mouseenter', () => {
                clearInterval(servicesInterval);
            });
            
            servicesContainer.addEventListener('mouseleave', () => {
                startServicesAutoSlide();
            });
        }
    }

    function slideServices(direction) {
        if (direction === 'next') {
            servicesCurrentSlide = servicesCurrentSlide >= servicesTotalSlides ? 0 : servicesCurrentSlide + 1;
        } else {
            servicesCurrentSlide = servicesCurrentSlide <= 0 ? servicesTotalSlides : servicesCurrentSlide - 1;
        }
        updateServicesSlider();
    }

    function updateServicesSlider() {
        const servicesContainer = document.getElementById('servicesContainer');
        if (servicesContainer) {
            servicesContainer.style.transform = `translateX(-${servicesCurrentSlide * 100}%)`;
            updateServicesDots();
        }
    }

    function createServicesDots() {
        const dotsContainer = document.getElementById('servicesDots');
        if (!dotsContainer) return;
        
        dotsContainer.innerHTML = '';
        for (let i = 0; i <= servicesTotalSlides; i++) {
            const dot = document.createElement('div');
            dot.className = `services-dot ${i === 0 ? 'active' : ''}`;
            dot.addEventListener('click', () => {
                servicesCurrentSlide = i;
                updateServicesSlider();
            });
            dotsContainer.appendChild(dot);
        }
    }

    function updateServicesDots() {
        document.querySelectorAll('.services-dot').forEach((dot, index) => {
            dot.classList.toggle('active', index === servicesCurrentSlide);
        });
    }

    function startServicesAutoSlide() {
        clearInterval(servicesInterval);
        servicesInterval = setInterval(() => {
            servicesCurrentSlide = servicesCurrentSlide >= servicesTotalSlides ? 0 : servicesCurrentSlide + 1;
            updateServicesSlider();
        }, 3000);
    }

    // ==================== REVIEWS SLIDER ====================
    function initReviewsSlider() {
        const reviewCards = document.querySelectorAll('.review-card');
        reviewsTotalSlides = reviewCards.length - 1;
        
        // Make cards visible with animation
        reviewCards.forEach((card, index) => {
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 200);
        });
        
        startReviewsAutoSlide();
        
        // Pause on hover
        const reviewContainer = document.getElementById('reviewContainer');
        if (reviewContainer) {
            reviewContainer.addEventListener('mouseenter', () => {
                clearInterval(reviewsInterval);
            });
            
            reviewContainer.addEventListener('mouseleave', () => {
                startReviewsAutoSlide();
            });
        }
    }

    function slideReviews(direction) {
        if (direction === 'next') {
            reviewsCurrentSlide = reviewsCurrentSlide >= reviewsTotalSlides ? 0 : reviewsCurrentSlide + 1;
        } else {
            reviewsCurrentSlide = reviewsCurrentSlide <= 0 ? reviewsTotalSlides : reviewsCurrentSlide - 1;
        }
        updateReviewsSlider();
    }

    function updateReviewsSlider() {
        const reviewContainer = document.getElementById('reviewContainer');
        if (reviewContainer) {
            reviewContainer.style.transform = `translateX(-${reviewsCurrentSlide * 100}%)`;
        }
    }

    function startReviewsAutoSlide() {
        clearInterval(reviewsInterval);
        reviewsInterval = setInterval(() => {
            reviewsCurrentSlide = reviewsCurrentSlide >= reviewsTotalSlides ? 0 : reviewsCurrentSlide + 1;
            updateReviewsSlider();
        }, 4000);
    }

    // ==================== COUNTER ANIMATION ====================
    function initCounter() {
        let count = 0;
        const target = 1200;
        const counterElement = document.getElementById('happyCount');
        
        if (!counterElement) return;
        
        function updateCounter() {
            if (count < target) {
                count += 24;
                counterElement.textContent = count > target ? target : count;
                setTimeout(updateCounter, 50);
            }
        }
        
        // Start counter after page load
        setTimeout(updateCounter, 1000);
    }

    // ==================== PRODUCT MANAGEMENT ====================
    async function loadAllProducts() {
        try {
            const response = await fetch(`${API_BASE_URL}/products`);
            if (response.ok) {
                const allProducts = await response.json();
                
                // Organize by category
                PRODUCTS = { indian: [], exotic: [], leafy: [], others: [], puja: [] };
                allProducts.forEach(product => {
                    if (PRODUCTS[product.category]) {
                        PRODUCTS[product.category].push(product);
                    }
                });
                
                console.log(`‚úÖ Products loaded: ${allProducts.length} total`);
            } else {
                loadSampleProducts();
            }
        } catch (error) {
            console.error("‚ùå Error loading products:", error);
            loadSampleProducts();
        }
    }

    function loadSampleProducts() {
        PRODUCTS = {
            indian: [
                { id: 1, name: "Potato", price: 30, image: "https://images.unsplash.com/photo-1518977676601-b53f82aba655", unit: "kg", stock: 50, category: "indian" },
                { id: 2, name: "Onion", price: 40, image: "https://images.unsplash.com/photo-1580201092675-a0a6a6cafbb1", unit: "kg", stock: 30, category: "indian" },
                { id: 3, name: "Tomato", price: 25, image: "https://images.unsplash.com/photo-1592924357228-91a4daadcfea", unit: "kg", stock: 40, category: "indian" }
            ],
            exotic: [
                { id: 4, name: "Broccoli", price: 80, image: "https://images.unsplash.com/photo-1459411552884-841db9b3cc2a", unit: "piece", stock: 10, category: "exotic" }
            ],
            leafy: [
                { id: 5, name: "Spinach", price: 15, image: "https://images.unsplash.com/photo-1576045057995-568f588f82fb", unit: "bunch", stock: 20, category: "leafy" }
            ],
            others: [
                { id: 6, name: "Paneer", price: 200, image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38", unit: "kg", stock: 15, category: "others" }
            ],
            puja: [
                { id: 7, name: "Coconut", price: 25, image: "https://images.unsplash.com/photo-1564671165096-7e3d7d8a7c3f", unit: "piece", stock: 50, category: "puja" }
            ]
        };
        console.log("üì¶ Loaded sample products");
    }

    function loadCategoryProducts(category) {
        const products = PRODUCTS[category] || [];
        const container = document.getElementById('productsContainer');
        
        if (!container) return;
        
        if (products.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-box-open" style="font-size: 48px; opacity: 0.5;"></i>
                    <p>No products available in ${category} category</p>
                    <button onclick="loadCategory('${category}')" style="
                        background: linear-gradient(135deg, #4CAF50, #2E7D32);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 8px;
                        margin-top: 10px;
                        cursor: pointer;
                    ">
                        <i class="fas fa-sync-alt"></i> Try Again
                    </button>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        products.forEach((product, index) => {
            renderProduct(product, index);
        });
        
        console.log(`‚úÖ Loaded ${products.length} ${category} products`);
    }

    function renderProduct(product, index) {
        const container = document.getElementById('productsContainer');
        if (!container) return;
        
        const isOutOfStock = (product.stock || 0) <= 0;
        const isLowStock = (product.stock || 0) > 0 && (product.stock || 0) < 10;
        
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.style.animationDelay = `${index * 0.1}s`;
        
        productCard.innerHTML = `
            ${isOutOfStock ? '<div class="out-of-stock">Out of Stock</div>' : ''}
            ${isLowStock ? '<div class="stock-badge">Low Stock</div>' : ''}
            <img src="${product.image}" alt="${product.name}" class="product-image">
            <div class="product-info">
                <div class="product-name">${product.name}</div>
                <div class="product-price">‚Çπ${product.price}<span style="font-size: 12px; color: #666;">/${product.unit}</span></div>
                <div class="quantity-selector">
                    <div class="quantity-options" id="qty-${product.id}">
                        ${getQuantityOptions(product.unit).map(opt => `
                            <div class="quantity-option" data-value="${opt.value}" onclick="selectQuantity(${product.id}, ${opt.value})" 
                                 ${isOutOfStock ? 'style="pointer-events: none; opacity: 0.5;"' : ''}>
                                ${opt.label}
                            </div>
                        `).join('')}
                    </div>
                    <div class="custom-quantity">
                        <input type="number" id="custom-${product.id}" placeholder="Custom" min="0.1" step="0.1" 
                               oninput="setCustomQuantity(${product.id}, this.value)" 
                               ${isOutOfStock ? 'disabled' : ''}>
                        <span style="font-size: 12px; color: #666;">${product.unit}</span>
                    </div>
                </div>
                <button class="add-to-cart" onclick="addToCart(${product.id})" ${isOutOfStock ? 'disabled' : ''}>
                    ${isOutOfStock ? 'Out of Stock' : 'Add to Cart'}
                </button>
            </div>
        `;
        
        container.appendChild(productCard);
    }

    function getQuantityOptions(unit) {
        if (unit === 'kg' || unit === 'liter') {
            return [
                { label: "250g", value: 0.25 },
                { label: "500g", value: 0.5 },
                { label: "1kg", value: 1 },
                { label: "2kg", value: 2 }
            ];
        } else {
            return [
                { label: "1", value: 1 },
                { label: "2", value: 2 },
                { label: "3", value: 3 },
                { label: "4", value: 4 }
            ];
        }
    }

    function selectQuantity(productId, quantity) {
        selectedQuantities[productId] = quantity;
        
        // Remove active class from all options
        document.querySelectorAll(`#qty-${productId} .quantity-option`).forEach(opt => {
            opt.classList.remove('active');
        });
        
        // Add active class to clicked option
        if (event && event.target) {
            event.target.classList.add('active');
        }
        
        // Clear custom input
        const customInput = document.getElementById(`custom-${productId}`);
        if (customInput) {
            customInput.value = '';
        }
    }

    function setCustomQuantity(productId, value) {
        const numValue = parseFloat(value);
        if (!isNaN(numValue) && numValue > 0) {
            selectedQuantities[productId] = numValue;
            
            // Remove active class from pre-defined options
            document.querySelectorAll(`#qty-${productId} .quantity-option`).forEach(opt => {
                opt.classList.remove('active');
            });
        }
    }

    function filterProducts(searchTerm) {
        if (!searchTerm || searchTerm.trim() === '') {
            loadCategoryProducts(currentCategory);
            return;
        }
        
        const allProducts = Object.values(PRODUCTS).flat();
        const filteredProducts = allProducts.filter(product => 
            product.name.toLowerCase().includes(searchTerm.toLowerCase())
        );
        
        const container = document.getElementById('productsContainer');
        if (!container) return;
        
        if (filteredProducts.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                    <i class="fas fa-search" style="font-size: 48px; opacity: 0.5;"></i>
                    <p>No products found for "${searchTerm}"</p>
                    <button onclick="loadCategoryProducts(currentCategory)" style="
                        background: linear-gradient(135deg, #4CAF50, #2E7D32);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 8px;
                        margin-top: 10px;
                        cursor: pointer;
                    ">
                        Show All Products
                    </button>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        filteredProducts.forEach((product, index) => {
            renderProduct(product, index);
        });
        
        console.log(`üîç Found ${filteredProducts.length} products for "${searchTerm}"`);
    }

    // ==================== CART FUNCTIONS ====================
    function addToCart(productId) {
        const quantity = selectedQuantities[productId];
        
        if (!quantity || quantity <= 0) {
            showNotification('Please select quantity first', 'error');
            return;
        }
        
        // Find product
        let product;
        for (const cat in PRODUCTS) {
            product = PRODUCTS[cat].find(p => p.id === productId);
            if (product) break;
        }
        
        if (!product) {
            showNotification('Product not found', 'error');
            return;
        }
        
        // Check stock
        if ((product.stock || 0) < quantity) {
            showNotification(`Only ${product.stock} ${product.unit} available`, 'error');
            return;
        }
        
        // Add to cart
        const existingItem = cart.find(item => item.id === productId);
        if (existingItem) {
            existingItem.quantity += quantity;
        } else {
            cart.push({
                id: productId,
                name: product.name,
                price: product.price,
                quantity: quantity,
                unit: product.unit
            });
        }
        
        // Update stock (locally)
        product.stock = (product.stock || 0) - quantity;
        
        // Reset selection
        selectedQuantities[productId] = 0;
        document.querySelectorAll(`#qty-${productId} .quantity-option`).forEach(opt => {
            opt.classList.remove('active');
        });
        
        const customInput = document.getElementById(`custom-${productId}`);
        if (customInput) {
            customInput.value = '';
        }
        
        updateCartCount();
        showNotification(`${product.name} added to cart`);
        
        // Refresh product display
        loadCategoryProducts(currentCategory);
    }

    function updateCartCount() {
        const total = cart.reduce((sum, item) => sum + item.quantity, 0);
        const cartCountElement = document.getElementById('cartCount');
        if (cartCountElement) {
            cartCountElement.textContent = total;
        }
    }

    function openCart() {
        if (cart.length === 0) {
            showNotification('Your cart is empty');
            return;
        }
        
        renderCartItems();
        document.getElementById('cartModal').style.display = 'flex';
    }

    function closeCart() {
        document.getElementById('cartModal').style.display = 'none';
    }

    function renderCartItems() {
        const itemsContainer = document.getElementById('cartItems');
        const cartTotalElement = document.getElementById('cartTotal');
        
        if (!itemsContainer || !cartTotalElement) return;
        
        let subtotal = 0;
        itemsContainer.innerHTML = '';
        
        cart.forEach(item => {
            const total = item.price * item.quantity;
            subtotal += total;
            
            const itemDiv = document.createElement('div');
            itemDiv.style.display = 'flex';
            itemDiv.style.justifyContent = 'space-between';
            itemDiv.style.alignItems = 'center';
            itemDiv.style.padding = '10px 0';
            itemDiv.style.borderBottom = '1px solid #eee';
            
            itemDiv.innerHTML = `
                <div>
                    <div style="font-weight: bold;">${item.name}</div>
                    <div style="color: #e74c3c; font-size: 14px;">‚Çπ${item.price}/${item.unit} √ó ${item.quantity}</div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button onclick="updateCartItem(${item.id}, -0.1)" style="background: #f0f0f0; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">-</button>
                    <span style="min-width: 40px; text-align: center;">${item.quantity}</span>
                    <button onclick="updateCartItem(${item.id}, 0.1)" style="background: #f0f0f0; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">+</button>
                    <button onclick="removeFromCart(${item.id})" style="background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-trash" style="font-size: 12px;"></i>
                    </button>
                </div>
            `;
            itemsContainer.appendChild(itemDiv);
        });
        
        const packaging = BUSINESS_INFO.packagingCharge || 10;
        const total = subtotal + packaging;
        
        cartTotalElement.innerHTML = `
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span>Subtotal:</span>
                <span>‚Çπ${subtotal.toFixed(2)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span>Packaging Charge:</span>
                <span>‚Çπ${packaging}</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                <span>Total:</span>
                <span>‚Çπ${total.toFixed(2)}</span>
            </div>
        `;
    }

    function updateCartItem(productId, change) {
        const item = cart.find(item => item.id === productId);
        if (!item) return;
        
        // Update quantity
        item.quantity = Math.max(0.1, item.quantity + change);
        
        if (item.quantity <= 0.1) {
            // Remove item if quantity is too low
            cart = cart.filter(item => item.id !== productId);
        }
        
        updateCartCount();
        
        // Update stock in products
        for (const cat in PRODUCTS) {
            const product = PRODUCTS[cat].find(p => p.id === productId);
            if (product) {
                if (change < 0) {
                    product.stock = (product.stock || 0) + Math.abs(change);
                } else if (change > 0 && (product.stock || 0) >= change) {
                    product.stock = (product.stock || 0) - change;
                }
                break;
            }
        }
        
        if (cart.length === 0) {
            closeCart();
        } else {
            renderCartItems();
        }
        
        // Refresh products display
        loadCategoryProducts(currentCategory);
    }

    function removeFromCart(productId) {
        // Find the item to restore stock
        const item = cart.find(item => item.id === productId);
        if (item) {
            // Restore stock
            for (const cat in PRODUCTS) {
                const product = PRODUCTS[cat].find(p => p.id === productId);
                if (product) {
                    product.stock = (product.stock || 0) + item.quantity;
                    break;
                }
            }
        }
        
        // Remove from cart
        cart = cart.filter(item => item.id !== productId);
        
        updateCartCount();
        
        if (cart.length === 0) {
            closeCart();
        } else {
            renderCartItems();
        }
        
        // Refresh products display
        loadCategoryProducts(currentCategory);
        
        showNotification('Item removed from cart');
    }

    // ==================== CHECKOUT FUNCTIONS ====================
    function checkBusinessHours() {
        const now = new Date();
        const currentHour = now.getHours();
        
        // Store hours: 10 AM to 10 PM
        if (currentHour >= 10 && currentHour < 22) {
            openCheckoutModal();
        } else {
            document.getElementById('businessHoursModal').style.display = 'flex';
        }
    }

    function openCheckoutModal() {
        if (cart.length === 0) {
            showNotification('Your cart is empty');
            return;
        }
        
        renderBillingSummary();
        document.getElementById('checkoutModal').style.display = 'flex';
        closeCart();
    }

    function closeCheckoutModal() {
        document.getElementById('checkoutModal').style.display = 'none';
    }

    function closeBusinessHoursModal() {
        document.getElementById('businessHoursModal').style.display = 'none';
    }

    function renderBillingSummary() {
        const billingSummary = document.getElementById('billingSummary');
        if (!billingSummary) return;
        
        let subtotal = 0;
        let itemsHTML = '';
        
        cart.forEach(item => {
            const total = item.price * item.quantity;
            subtotal += total;
            itemsHTML += `
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>${item.name} (${item.quantity}${item.unit})</span>
                    <span>‚Çπ${total.toFixed(2)}</span>
                </div>
            `;
        });
        
        const packaging = BUSINESS_INFO.packagingCharge || 10;
        const total = subtotal + packaging;
        const advance = total * 0.5;
        
        billingSummary.innerHTML = `
            <h3 style="margin-bottom: 15px;">Order Summary</h3>
            ${itemsHTML}
            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-top: 1px solid #ddd; margin-top: 10px;">
                <span>Subtotal:</span>
                <span>‚Çπ${subtotal.toFixed(2)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                <span>Packaging Charge:</span>
                <span>‚Çπ${packaging}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 5px 0; font-weight: bold; font-size: 16px;">
                <span>Total Amount:</span>
                <span>‚Çπ${total.toFixed(2)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 5px 0; color: #e74c3c; font-weight: bold; margin-top: 10px;">
                <span>50% Advance Payment:</span>
                <span>‚Çπ${advance.toFixed(2)}</span>
            </div>
        `;
    }

    function validateAndCheckout() {
        const name = document.getElementById('customerName').value.trim();
        const phone = document.getElementById('customerPhone').value.trim();
        
        if (!name || !phone) {
            showNotification('Please fill all required fields', 'error');
            return;
        }
        
        if (phone.length < 10) {
            showNotification('Please enter a valid phone number', 'error');
            return;
        }
        
        processCheckout(name, phone);
    }

    function processCheckout(name, phone) {
        let subtotal = 0;
        let message = `*Sabji Haat - New Order*\n\n`;
        message += `*Order Date:* ${new Date().toLocaleDateString('en-IN')}\n`;
        message += `*Customer:* ${name}\n`;
        message += `*Phone:* ${phone}\n\n`;
        message += `*Order Items:*\n`;
        
        cart.forEach(item => {
            const total = item.price * item.quantity;
            subtotal += total;
            message += `‚Ä¢ ${item.name} - ${item.quantity}${item.unit} √ó ‚Çπ${item.price} = ‚Çπ${total.toFixed(2)}\n`;
        });
        
        const packaging = BUSINESS_INFO.packagingCharge || 10;
        const total = subtotal + packaging;
        const advance = total * 0.5;
        
        message += `\n*Order Summary:*\n`;
        message += `Subtotal: ‚Çπ${subtotal.toFixed(2)}\n`;
        message += `Packaging: ‚Çπ${packaging}\n`;
        message += `*Total: ‚Çπ${total.toFixed(2)}*\n`;
        message += `*Advance (50%): ‚Çπ${advance.toFixed(2)}*\n\n`;
        message += `*Payment Instructions:*\n`;
        message += `1. Send ‚Çπ${advance.toFixed(2)} advance payment\n`;
        message += `2. Payment to: ${BUSINESS_INFO.phone}\n`;
        message += `3. Send payment screenshot\n`;
        message += `4. Collect from store with remaining payment\n\n`;
        message += `*Pickup Address:*\n`;
        message += `${BUSINESS_INFO.address}\n\n`;
        message += `Thank you for choosing Sabji Haat! ü•¶`;
        
        const encoded = encodeURIComponent(message);
        window.open(`https://wa.me/${BUSINESS_INFO.phone.replace('+', '')}?text=${encoded}`, '_blank');
        
        // Clear cart
        cart = [];
        updateCartCount();
        closeCheckoutModal();
        
        showNotification('Order sent to WhatsApp! Please send payment screenshot.', 'success');
        
        // Refresh products
        loadCategoryProducts(currentCategory);
    }

    // ==================== PAGE NAVIGATION ====================
    function showAboutPage() {
        document.querySelector('.main-app').style.display = 'none';
        document.getElementById('aboutPage').style.display = 'block';
        window.scrollTo(0, 0);
    }

    function showHomePage() {
        document.getElementById('aboutPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'none';
        document.querySelector('.main-app').style.display = 'block';
        window.scrollTo(0, 0);
    }

    // ==================== ADMIN FUNCTIONS ====================
    function setupAdminAccess() {
        const homeButton = document.getElementById('homeButton');
        if (!homeButton) return;
        
        let pressTimer;
        let clickCount = 0;
        let clickTimer;
        
        // Long press (10 seconds)
        homeButton.addEventListener('mousedown', () => {
            pressTimer = setTimeout(() => {
                openAdminLogin();
            }, 10000);
        });
        
        homeButton.addEventListener('mouseup', () => {
            clearTimeout(pressTimer);
        });
        
        homeButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            pressTimer = setTimeout(() => {
                openAdminLogin();
            }, 10000);
        });
        
        homeButton.addEventListener('touchend', (e) => {
            e.preventDefault();
            clearTimeout(pressTimer);
        });
        
        // Triple click
        homeButton.addEventListener('click', () => {
            clickCount++;
            
            if (clickTimer) {
                clearTimeout(clickTimer);
            }
            
            clickTimer = setTimeout(() => {
                if (clickCount >= 3) {
                    openAdminLogin();
                }
                clickCount = 0;
            }, 1000);
        });
    }

    function openAdminLogin() {
        document.getElementById('adminLoginModal').style.display = 'flex';
    }

    function closeAdminLogin() {
        document.getElementById('adminLoginModal').style.display = 'none';
        document.getElementById('adminUsername').value = '';
        document.getElementById('adminPassword').value = '';
    }

    async function adminLogin(event) {
        if (event) event.preventDefault();
        
        const username = document.getElementById('adminUsername').value;
        const password = document.getElementById('adminPassword').value;
        
        if (!username || !password) {
            showNotification('Please enter credentials', 'error');
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE_URL}/admin/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            
            if (response.ok) {
                const data = await response.json();
                adminToken = data.token;
                localStorage.setItem('adminToken', adminToken);
                showAdminPanel();
                showNotification('Admin login successful');
            } else {
                // Fallback for testing
                if (username === 'admin' && password === 'sabjihaat2025') {
                    adminToken = 'test-token';
                    showAdminPanel();
                    showNotification('Admin login successful (offline mode)');
                } else {
                    showNotification('Invalid credentials', 'error');
                }
            }
        } catch (error) {
            console.error('Login error:', error);
            // Fallback for offline testing
            if (username === 'admin' && password === 'sabjihaat2025') {
                adminToken = 'offline-token';
                showAdminPanel();
                showNotification('Admin login successful (offline mode)');
            } else {
                showNotification('Login failed. Check connection.', 'error');
            }
        }
    }

    function showAdminPanel() {
        closeAdminLogin();
        document.querySelector('.main-app').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadAdminProducts();
        window.scrollTo(0, 0);
    }

    function adminLogout() {
        adminToken = null;
        localStorage.removeItem('adminToken');
        showHomePage();
        showNotification('Logged out successfully');
    }

    function switchAdminTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.admin-tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Remove active from all buttons
        document.querySelectorAll('.admin-tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show selected tab
        document.getElementById(`${tabName}Tab`).classList.add('active');
        
        // Add active to clicked button
        if (event && event.target) {
            event.target.classList.add('active');
        }
        
        // Load data if needed
        if (tabName === 'stock') {
            loadStockManagement();
        } else if (tabName === 'settings') {
            loadAdminSettings();
        }
    }

    async function loadAdminProducts() {
        try {
            const response = await fetch(`${API_BASE_URL}/products`);
            const products = response.ok ? await response.json() : Object.values(PRODUCTS).flat();
            
            const container = document.getElementById('adminProductList');
            if (!container) return;
            
            container.innerHTML = '';
            
            products.forEach(product => {
                const div = document.createElement('div');
                div.className = 'admin-product-item';
                div.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px;
                    border-bottom: 1px solid #eee;
                    background: #f9f9f9;
                    margin-bottom: 8px;
                    border-radius: 5px;
                `;
                
                div.innerHTML = `
                    <div>
                        <div style="font-weight: bold;">${product.name}</div>
                        <div style="font-size: 12px; color: #666;">‚Çπ${product.price}/${product.unit} | ${product.category} | Stock: ${product.stock || 0}</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button onclick="editProduct(${product.id})" style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Edit</button>
                        <button onclick="deleteProduct(${product.id})" style="background: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Delete</button>
                    </div>
                `;
                container.appendChild(div);
            });
            
            // Update product count
            const totalProducts = document.getElementById('totalProducts');
            if (totalProducts) {
                totalProducts.textContent = products.length;
            }
        } catch (error) {
            console.error('Error loading admin products:', error);
        }
    }

    function loadStockManagement() {
        const container = document.getElementById('stockList');
        if (!container) return;
        
        const allProducts = Object.values(PRODUCTS).flat();
        
        container.innerHTML = '';
        allProducts.forEach(product => {
            const div = document.createElement('div');
            div.style.cssText = `
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                border-bottom: 1px solid #eee;
                background: #f9f9f9;
                margin-bottom: 8px;
                border-radius: 5px;
            `;
            
            const isOutOfStock = (product.stock || 0) <= 0;
            
            div.innerHTML = `
                <div>
                    <div style="font-weight: bold;">${product.name}</div>
                    <div style="font-size: 12px; color: #666;">${product.category} | ‚Çπ${product.price}/${product.unit}</div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 12px; padding: 3px 8px; border-radius: 10px; background: ${isOutOfStock ? '#ffebee' : '#e8f5e9'}; color: ${isOutOfStock ? '#c62828' : '#2e7d32'}">
                        ${isOutOfStock ? 'Out of Stock' : 'In Stock'}
                    </span>
                    <input type="number" id="stock-${product.id}" value="${product.stock || 0}" style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                    <button onclick="updateStock(${product.id})" style="background: #2ecc71; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Update</button>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function loadAdminSettings() {
        const packagingChargeInput = document.getElementById('packagingCharge');
        if (packagingChargeInput) {
            packagingChargeInput.value = BUSINESS_INFO.packagingCharge || 10;
        }
    }

    async function updateStock(productId) {
        const newStock = parseInt(document.getElementById(`stock-${productId}`).value) || 0;
        
        try {
            if (adminToken) {
                await fetch(`${API_BASE_URL}/products/${productId}/stock`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify({ stock: newStock })
                });
            }
            
            // Update locally
            for (const cat in PRODUCTS) {
                const product = PRODUCTS[cat].find(p => p.id === productId);
                if (product) {
                    product.stock = newStock;
                    break;
                }
            }
            
            showNotification('Stock updated successfully');
            loadCategoryProducts(currentCategory);
        } catch (error) {
            showNotification('Error updating stock', 'error');
        }
    }

    async function saveSettings() {
        const charge = parseInt(document.getElementById('packagingCharge').value) || 10;
        BUSINESS_INFO.packagingCharge = charge;
        
        try {
            if (adminToken) {
                await fetch(`${API_BASE_URL}/business-info`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify({ packagingCharge: charge })
                });
            }
            
            showNotification('Settings saved successfully');
        } catch (error) {
            showNotification('Settings saved locally', 'info');
        }
    }
    // ==================== ADD PRODUCT FORM ====================
function showAddProductForm() {
    const container = document.getElementById('adminProductList');
    if (!container) return;
    
    container.innerHTML = `
        <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-bottom: 15px;">‚ûï Add New Product</h3>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Product Name *</label>
                <input type="text" id="newProductName" placeholder="e.g., Potato" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Price (‚Çπ) *</label>
                <input type="number" id="newProductPrice" placeholder="e.g., 30" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Unit *</label>
                <select id="newProductUnit" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="kg">kg</option>
                    <option value="piece">Piece</option>
                    <option value="bunch">Bunch</option>
                    <option value="packet">Packet</option>
                    <option value="liter">Liter</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Category *</label>
                <select id="newProductCategory" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="indian">Indian</option>
                    <option value="exotic">Exotic</option>
                    <option value="leafy">Leafy</option>
                    <option value="others">Others</option>
                    <option value="puja">Puja Needs</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Initial Stock *</label>
                <input type="number" id="newProductStock" value="10" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">Product Image URL</label>
                <input type="text" id="newProductImage" placeholder="https://example.com/image.jpg" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <p style="font-size: 12px; color: #666; margin-top: 5px;">
                    Leave empty for default image, or paste image URL
                </p>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="saveNewProduct()" style="
                    background: linear-gradient(135deg, #2ecc71, #27ae60);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                    flex: 1;
                ">
                    <i class="fas fa-save"></i> Save Product
                </button>
                
                <button onclick="cancelAddProduct()" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    ` + container.innerHTML;
    
    // Scroll to form
    container.scrollIntoView({ behavior: 'smooth' });
}

function cancelAddProduct() {
    loadAdminProducts();
}

async function saveNewProduct() {
    const name = document.getElementById('newProductName').value.trim();
    const price = document.getElementById('newProductPrice').value;
    const unit = document.getElementById('newProductUnit').value;
    const category = document.getElementById('newProductCategory').value;
    const stock = document.getElementById('newProductStock').value;
    let image = document.getElementById('newProductImage').value.trim();
    
    // Validation
    if (!name || !price || !unit || !category) {
        showNotification('Please fill all required fields', 'error');
        return;
    }
    
    if (price <= 0) {
        showNotification('Price must be greater than 0', 'error');
        return;
    }
    
    // Default image if not provided
    if (!image) {
        image = 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80';
    }
    
    try {
        const response = await fetch('${API_BASE_URL}/products', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${adminToken}`
            },
            body: JSON.stringify({
                name,
                price: parseFloat(price),
                unit,
                category,
                stock: parseInt(stock) || 0,
                image
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Product added successfully!');
            loadAdminProducts();
            
            // Also update local products
            const newProduct = data.data;
            if (PRODUCTS[category]) {
                PRODUCTS[category].push({
                    id: newProduct._id || Date.now(),
                    name: newProduct.name,
                    price: newProduct.price,
                    unit: newProduct.unit,
                    stock: newProduct.stock,
                    category: newProduct.category,
                    image: newProduct.image
                });
            }
            
            // Refresh current category view if needed
            if (currentCategory === category) {
                loadCategoryProducts(category);
            }
        } else {
            showNotification(data.error || 'Failed to add product', 'error');
        }
    } catch (error) {
        console.error('Error adding product:', error);
        showNotification('Network error. Product saved locally.', 'info');
        
        // Add to local products for offline mode
        const newId = Date.now();
        if (PRODUCTS[category]) {
            PRODUCTS[category].push({
                id: newId,
                name,
                price: parseFloat(price),
                unit,
                stock: parseInt(stock) || 0,
                category,
                image
            });
            
            showNotification('Product added locally (offline mode)');
            loadAdminProducts();
            
            if (currentCategory === category) {
                loadCategoryProducts(category);
            }
        }
    }
    }
    // ==================== ADD PRODUCT FORM ====================
function showAddProductForm() {
    const container = document.getElementById('adminProductList');
    if (!container) return;
    
    container.innerHTML = `
        <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-bottom: 15px;">‚ûï Add New Product</h3>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Product Name *</label>
                <input type="text" id="newProductName" placeholder="e.g., Potato" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Price (‚Çπ) *</label>
                <input type="number" id="newProductPrice" placeholder="e.g., 30" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Unit *</label>
                <select id="newProductUnit" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="kg">kg</option>
                    <option value="piece">Piece</option>
                    <option value="bunch">Bunch</option>
                    <option value="packet">Packet</option>
                    <option value="liter">Liter</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Category *</label>
                <select id="newProductCategory" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="indian">Indian</option>
                    <option value="exotic">Exotic</option>
                    <option value="leafy">Leafy</option>
                    <option value="others">Others</option>
                    <option value="puja">Puja Needs</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Initial Stock *</label>
                <input type="number" id="newProductStock" value="10" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">Product Image URL</label>
                <input type="text" id="newProductImage" placeholder="https://example.com/image.jpg" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <p style="font-size: 12px; color: #666; margin-top: 5px;">
                    Leave empty for default image, or paste image URL
                </p>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="saveNewProduct()" style="
                    background: linear-gradient(135deg, #2ecc71, #27ae60);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                    flex: 1;
                ">
                    <i class="fas fa-save"></i> Save Product
                </button>
                
                <button onclick="cancelAddProduct()" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 12px 20px;

    // ==================== UTILITY FUNCTIONS ====================
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        if (!notification) return;
        
        notification.textContent = message;
        notification.className = `notification ${type === 'error' ? 'error' : ''}`;
        notification.style.display = 'block';
        
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }

    // ==================== SOCIAL FUNCTIONS ====================
    function openWhatsApp() {
        window.open(`https://wa.me/${BUSINESS_INFO.phone.replace('+', '')}`, '_blank');
    }

    function openFacebook() {
        window.open(BUSINESS_INFO.facebook, '_blank');
    }

    function openInstagram() {
        window.open(BUSINESS_INFO.instagram, '_blank');
    }

    function openGoogleReview() {
        window.open(BUSINESS_INFO.googleReview, '_blank');*/*\

// ==================== CONFIGURATION ====================
const API_BASE_URL = "https://sabjihaat-backend.onrender.com";
const BUSINESS_INFO = {
    name: "Sabji Haat",
    phone: "+919051410591",
    address: "Jadavpur Sandhya Bazar Rd, West Bengal Kolkata700075",
    instagram: "https://www.instagram.com/invites/contact/?utm_source=ig_contact_invite&utm_medium=copy_link&utm_content=seyxfz6",
    facebook: "https://www.facebook.com/sabjihaat?mibextid=ZbWKwL",
    googleReview: "https://maps.app.goo.gl/1DNV5UUPp2MXR81fA",
    packagingCharge: 10
};

// ==================== GLOBAL STATE ====================
let PRODUCTS = { indian: [], exotic: [], leafy: [], others: [], puja: [] };
let cart = [];
let selectedQuantities = {};
let currentCategory = 'indian';
let adminToken = null;
let servicesCurrentSlide = 0;
let servicesTotalSlides = 0;
let reviewsCurrentSlide = 0;
let reviewsTotalSlides = 5;
let servicesInterval;
let reviewsInterval;

// ==================== INITIALIZE APP ====================
document.addEventListener('DOMContentLoaded', function() {
    console.log("üöÄ Sabji Haat App Starting...");
    
    // Initialize components
    initServicesSlider();
    initReviewsSlider();
    initCounter();
    setupAdminAccess();
    setupEventListeners();
    
    // Load initial data
    loadAllProducts();
    setTimeout(() => {
        loadCategoryProducts('indian');
    }, 500);
    
    // Initialize first category as active
    setTimeout(() => {
        document.querySelector('.category-item').click();
    }, 1000);
    
    console.log("‚úÖ App Initialized");
});

// ==================== CATEGORY FUNCTIONS ====================
function loadCategory(category) {
    console.log(`Loading category: ${category}`);
    
    // 1. Remove active class from ALL category items
    document.querySelectorAll('.category-image-wrapper').forEach(wrapper => {
        wrapper.classList.remove('active');
    });
    
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // 2. Add active class to SELECTED category
    const selectedImage = document.querySelector(`.category-image-wrapper[data-category="${category}"]`);
    const selectedButton = document.querySelector(`.category-btn[data-category="${category}"]`);
    
    if (selectedImage) {
        selectedImage.classList.add('active');
    }
    
    if (selectedButton) {
        selectedButton.classList.add('active');
    }
    
    // 3. Show loading animation
    const productsContainer = document.getElementById('productsContainer');
    productsContainer.innerHTML = `
        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
            <div class="loading-spinner"></div>
            <p>Loading ${category} products...</p>
        </div>
    `;
    
            background-color: white;
            background-color: white;
            padding: 10px 12px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #eee;
        }
        
        nav {
            display: flex;
            justify-content: center;
            gap: 30px;
        }
        
        nav a {
            color: black;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            padding: 8px 15px;
            transition: all 0.3s ease;
            border-radius: 4px;
       const category = this.querySelector('.category-btn').getAttribute('data-category');
            console.log(`Category clicked: ${category}`);
            loadCategory(category);
        });
    });
    
    // 2. Search functionality
    const searchInput = document.getElementById('searchInput');
    const searchIcon = document.getElementById('searchIcon');
    
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.trim().toLowerCase();
            console.log(`Searching for: ${searchTerm}`);
            filterProducts(searchTerm);
        });
        
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const searchTerm = this.value.trim().toLowerCase();
                filterProducts(searchTerm);
                this.blur();
            }
        });
    }
    
    if (searchIcon) {
        searchIcon.addEventListener('click', function() {
            searchInput.focus();
            searchInput.select();
        });
    }
    
    // 3. Setup modal close events
    setupModalCloseEvents();
    
    console.log("‚úÖ Event listeners setup complete");
}

function setupModalCloseEvents() {
    // Cart modal
    const cartModal = document.getElementById('cartModal');
    if (cartModal) {
        cartModal.addEventListener('click', function(e) {
            if (e.target === cartModal) {
                closeCart();
            }
        });
    }
    
    // Checkout modal
    const checkoutModal = document.getElementById('checkoutModal');
    if (checkoutModal) {
        checkoutModal.addEventListener('click', function(e) {
            if (e.target === checkoutModal) {
                closeCheckoutModal();
            }
        });
    }
    
    // Admin login modal
    const adminLoginModal = document.getElementById('adminLoginModal');
    if (adminLoginModal) {
        adminLoginModal.addEventListener('click', function(e) {
            if (e.target === adminLoginModal) {
                closeAdminLogin();
            }
        });
    }
    
    // Business hours modal
    const businessHoursModal = document.getElementById('businessHoursModal');
    if (businessHoursModal) {
        businessHoursModal.addEventListener('click', function(e) {
            if (e.target === businessHoursModal) {
                closeBusinessHoursModal();
            }
        });
    }
}

// ==================== SERVICES SLIDER ====================
function initServicesSlider() {
    const serviceCards = document.querySelectorAll('.service-card');
    servicesTotalSlides = Math.ceil(serviceCards.length / 3) - 1;
    createServicesDots();
    startServicesAutoSlide();
    
    // Pause on hover
    const servicesContainer = document.getElementById('servicesContainer');
    if (servicesContainer) {
        servicesContainer.addEventListener('mouseenter', () => {
            clearInterval(servicesInterval);
        });
        
        servicesContainer.addEventListener('mouseleave', () => {
            startServicesAutoSlide();
        });
    }
}

function slideServices(direction) {
    if (direction === 'next') {
        servicesCurrentSlide = servicesCurrentSlide >= servicesTotalSlides ? 0 : servicesCurrentSlide + 1;
    } else {
        servicesCurrentSlide = servicesCurrentSlide <= 0 ? servicesTotalSlides : servicesCurrentSlide - 1;
    }
    updateServicesSlider();
}

function updateServicesSlider() {
    const servicesContainer = document.getElementById('servicesContainer');
    if (servicesContainer) {
        servicesContainer.style.transform = `translateX(-${servicesCurrentSlide * 100}%)`;
        updateServicesDots();
    }
}

function createServicesDots() {
    const dotsContainer = document.getElementById('servicesDots');
    if (!dotsContainer) return;
    
    dotsContainer.innerHTML = '';
    for (let i = 0; i <= servicesTotalSlides; i++) {
        const dot = document.createElement('div');
        dot.className = `services-dot ${i === 0 ? 'active' : ''}`;
        dot.addEventListener('click', () => {
            servicesCurrentSlide = i;
            updateServicesSlider();
        });
        dotsContainer.appendChild(dot);
    }
}

function updateServicesDots() {
    document.querySelectorAll('.services-dot').forEach((dot, index) => {
        dot.classList.toggle('active', index === servicesCurrentSlide);
    });
}

function startServicesAutoSlide() {
    clearInterval(servicesInterval);
    servicesInterval = setInterval(() => {
        servicesCurrentSlide = servicesCurrentSlide >= servicesTotalSlides ? 0 : servicesCurrentSlide + 1;
        updateServicesSlider();
    }, 3000);
}

// ==================== REVIEWS SLIDER ====================
// ==================== REVIEWS SLIDER - COMPLETELY FIXED ====================
let reviewsCurrentSlide = 0;
let reviewsTotalSlides = 0;
let reviewsInterval = null;

function initReviewsSlider() {
    console.log("üîÑ Initializing reviews slider...");
    
    const reviewCards = document.querySelectorAll('.review-card');
    reviewsTotalSlides = reviewCards.length - 1;
    
    if (reviewCards.length === 0) {
        console.error("‚ùå No review cards found!");
        return;
    }
    
    console.log(`üìä Found ${reviewCards.length} review cards`);
    
    // Ensure all cards are visible and properly positioned
    reviewCards.forEach((card, index) => {
        card.style.opacity = '1';
        card.style.transform = 'none';
        card.style.transition = 'transform 0.3s ease';
    });
    
    // Start auto-slide
    startReviewsAutoSlide();
    
    // Pause on hover
    const reviewContainer = document.getElementById('reviewContainer');
    const reviewWrapper = document.querySelector('.review-container-wrapper');
    
    if (reviewWrapper) {
        reviewWrapper.addEventListener('mouseenter', () => {
            console.log("‚è∏Ô∏è Pausing reviews auto-slide");
            clearInterval(reviewsInterval);
        });
        
        reviewWrapper.addEventListener('mouseleave', () => {
            console.log("‚ñ∂Ô∏è Resuming reviews auto-slide");
            startReviewsAutoSlide();
        });
    }
    
    console.log("‚úÖ Reviews slider initialized");
}

function slideReviews(direction) {
    console.log(`üîÑ Sliding reviews: ${direction}`);
    
    if (direction === 'next') {
        reviewsCurrentSlide = reviewsCurrentSlide >= reviewsTotalSlides ? 0 : reviewsCurrentSlide + 1;
    } else {
        reviewsCurrentSlide = reviewsCurrentSlide <= 0 ? reviewsTotalSlides : reviewsCurrentSlide - 1;
    }
    
    updateReviewsSlider();
    
    // Reset auto-slide timer
    clearInterval(reviewsInterval);
    startReviewsAutoSlide();
}

function updateReviewsSlider() {
    const reviewContainer = document.getElementById('reviewContainer');
    
    if (!reviewContainer) {
        console.error("‚ùå Review container not found!");
        return;
    }
    
    const translateX = -(reviewsCurrentSlide * 100);
    reviewContainer.style.transform = `translateX(${translateX}%)`;
    
    console.log(`üìä Current review slide: ${reviewsCurrentSlide}, Translate: ${translateX}%`);
}

function startReviewsAutoSlide() {
    clearInterval(reviewsInterval);
    
    reviewsInterval = setInterval(() => {
        reviewsCurrentSlide = reviewsCurrentSlide >= reviewsTotalSlides ? 0 : reviewsCurrentSlide + 1;
        updateReviewsSlider();
        console.log(`üîÑ Auto-slide to: ${reviewsCurrentSlide}`);
    }, 5000); // 5 seconds interval
}

// ==================== COUNTER ANIMATION - FIXED ====================
function initCounter() {
    console.log("üî¢ Initializing counter animation...");
    
    const counterElement = document.getElementById('happyCount');
    
    if (!counterElement) {
        console.error("‚ùå Counter element not found!");
        return;
    }
    
    // Set initial value
    counterElement.textContent = '0';
    
    // Start animation after a delay
    setTimeout(() => {
        animateCounter(counterElement, 0, 1200, 2000);
    }, 1000);
    
    console.log("‚úÖ Counter animation initialized");
}

function animateCounter(element, start, end, duration) {
    let startTimestamp = null;
    const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        
        const value = Math.floor(progress * (end - start) + start);
        element.textContent = value.toLocaleString();
        
        if (progress < 1) {
            window.requestAnimationFrame(step);
        }
    };
    
    window.requestAnimationFrame(step);
}

// ==================== DOMContentLoaded ‡§Æ‡•á‡§Ç add ‡§ï‡§∞‡•á‡§Ç ====================
document.addEventListener('DOMContentLoaded', function() {
    console.log("üöÄ Sabji Haat App Starting...");
    
    // Initialize components
    initServicesSlider();
    initReviewsSlider(); // ‚úÖ ‡§Ø‡§π add ‡§ï‡§∞‡•á‡§Ç
    initCounter(); // ‚úÖ ‡§Ø‡§π add ‡§ï‡§∞‡•á‡§Ç
    setupAdminAccess();
    setupEventListeners();
    
    // Load initial data
    loadAllProducts();
    setTimeout(() => {
        loadCategoryProducts('indian');
    }, 500);
    
    // Initialize first category as active
    setTimeout(() => {
        const firstCategory = document.querySelector('.category-item');
        if (firstCategory) {
            firstCategory.click();
        }
    }, 1000);
    
    console.log("‚úÖ App Initialized");
});

// ==================== GLOBAL FUNCTIONS ‡§Æ‡•á‡§Ç add ‡§ï‡§∞‡•á‡§Ç ====================
window.slideReviews = slideReviews;
window.initReviewsSlider = initReviewsSlider;
window.initCounter = initCounter;

// ==================== PRODUCT MANAGEMENT ====================
async function loadAllProducts() {
    try {
        const response = await fetch(`${API_BASE_URL}/api/products`);
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                const allProducts = data.data;
                
                // Organize by category
                PRODUCTS = { indian: [], exotic: [], leafy: [], others: [], puja: [] };
                allProducts.forEach(product => {
                    if (PRODUCTS[product.category]) {
                        PRODUCTS[product.category].push(product);
                    }
                });
                
                console.log(`‚úÖ Products loaded: ${allProducts.length} total`);
            } else {
                loadSampleProducts();
            }
        } else {
            loadSampleProducts();
        }
    } catch (error) {
        console.error("‚ùå Error loading products:", error);
        loadSampleProducts();
    }
}

function loadSampleProducts() {
    PRODUCTS = {
        indian: [
            { _id: 1, name: "Potato", price: 30, image: "https://images.unsplash.com/photo-1518977676601-b53f82aba655", unit: "kg", stock: 50, category: "indian" },
            { _id: 2, name: "Onion", price: 40, image: "https://images.unsplash.com/photo-1580201092675-a0a6a6cafbb1", unit: "kg", stock: 30, category: "indian" },
            { _id: 3, name: "Tomato", price: 25, image: "https://images.unsplash.com/photo-1592924357228-91a4daadcfea", unit: "kg", stock: 40, category: "indian" }
        ],
        exotic: [
            { _id: 4, name: "Broccoli", price: 80, image: "https://images.unsplash.com/photo-1459411552884-841db9b3cc2a", unit: "piece", stock: 10, category: "exotic" }
        ],
        leafy: [
            { _id: 5, name: "Spinach", price: 15, image: "https://images.unsplash.com/photo-1576045057995-568f588f82fb", unit: "bunch", stock: 20, category: "leafy" }
        ],
        others: [
            { _id: 6, name: "Paneer", price: 200, image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38", unit: "kg", stock: 15, category: "others" }
        ],
        puja: [
            { _id: 7, name: "Coconut", price: 25, image: "https://images.unsplash.com/photo-1564671165096-7e3d7d8a7c3f", unit: "piece", stock: 50, category: "puja" }
        ]
    };
    console.log("üì¶ Loaded sample products");
}

function loadCategoryProducts(category) {
    const products = PRODUCTS[category] || [];
    const container = document.getElementById('productsContainer');
    
    if (!container) return;
    
    if (products.length === 0) {
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-box-open" style="font-size: 48px; opacity: 0.5;"></i>
                <p>No products available in ${category} category</p>
                <button onclick="loadCategory('${category}')" style="
                    background: linear-gradient(135deg, #4CAF50, #2E7D32);
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 8px;
                    margin-top: 10px;
                    cursor: pointer;
                ">
                    <i class="fas fa-sync-alt"></i> Try Again
                </button>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    products.forEach((product, index) => {
        renderProduct(product, index);
    });
    
    console.log(`‚úÖ Loaded ${products.length} ${category} products`);
}

function renderProduct(product, index) {
    const container = document.getElementById('productsContainer');
    if (!container) return;
    
    const productId = product._id || product.id;
    const isOutOfStock = (product.stock || 0) <= 0;
    const isLowStock = (product.stock || 0) > 0 && (product.stock || 0) < 10;
    
    const productCard = document.createElement('div');
    productCard.className = 'product-card';
    productCard.style.animationDelay = `${index * 0.1}s`;
    
    productCard.innerHTML = `
        ${isOutOfStock ? '<div class="out-of-stock">Out of Stock</div>' : ''}
        ${isLowStock ? '<div class="stock-badge">Low Stock</div>' : ''}
        <img src="${product.image}" alt="${product.name}" class="product-image">
        <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-price">‚Çπ${product.price}<span style="font-size: 12px; color: #666;">/${product.unit}</span></div>
            <div class="quantity-selector">
                <div class="quantity-options" id="qty-${productId}">
                    ${getQuantityOptions(product.unit).map(opt => `
                        <div class="quantity-option" data-value="${opt.value}" onclick="selectQuantity(${productId}, ${opt.value})" 
                             ${isOutOfStock ? 'style="pointer-events: none; opacity: 0.5;"' : ''}>
                            ${opt.label}
                        </div>
                    `).join('')}
                </div>
                <div class="custom-quantity">
                    <input type="number" id="custom-${productId}" placeholder="Custom" min="0.1" step="0.1" 
                           oninput="setCustomQuantity(${productId}, this.value)" 
                           ${isOutOfStock ? 'disabled' : ''}>
                    <span style="font-size: 12px; color: #666;">${product.unit}</span>
                </div>
            </div>
            <button class="add-to-cart" onclick="addToCart(${productId})" ${isOutOfStock ? 'disabled' : ''}>
                ${isOutOfStock ? 'Out of Stock' : 'Add to Cart'}
            </button>
        </div>
    `;
    
    container.appendChild(productCard);
}

function getQuantityOptions(unit) {
    if (unit === 'kg' || unit === 'liter') {
        return [
            { label: "250g", value: 0.25 },
            { label: "500g", value: 0.5 },
            { label: "1kg", value: 1 },
            { label: "2kg", value: 2 }
        ];
    } else {
        return [
            { label: "1", value: 1 },
            { label: "2", value: 2 },
            { label: "3", value: 3 },
            { label: "4", value: 4 }
        ];
    }
}

function selectQuantity(productId, quantity) {
    selectedQuantities[productId] = quantity;
    
    // Remove active class from all options
    document.querySelectorAll(`#qty-${productId} .quantity-option`).forEach(opt => {
        opt.classList.remove('active');
    });
    
    // Add active class to clicked option
    if (event && event.target) {
        event.target.classList.add('active');
    }
    
    // Clear custom input
    const customInput = document.getElementById(`custom-${productId}`);
    if (customInput) {
        customInput.value = '';
    }
}

function setCustomQuantity(productId, value) {
    const numValue = parseFloat(value);
    if (!isNaN(numValue) && numValue > 0) {
        selectedQuantities[productId] = numValue;
        
        // Remove active class from pre-defined options
        document.querySelectorAll(`#qty-${productId} .quantity-option`).forEach(opt => {
            opt.classList.remove('active');
        });
    }
}

function filterProducts(searchTerm) {
    if (!searchTerm || searchTerm.trim() === '') {
        loadCategoryProducts(currentCategory);
        return;
    }
    
    const allProducts = Object.values(PRODUCTS).flat();
    const filteredProducts = allProducts.filter(product => 
        product.name.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    const container = document.getElementById('productsContainer');
    if (!container) return;
    
    if (filteredProducts.length === 0) {
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                <i class="fas fa-search" style="font-size: 48px; opacity: 0.5;"></i>
                <p>No products found for "${searchTerm}"</p>
                <button onclick="loadCategoryProducts(currentCategory)" style="
                    background: linear-gradient(135deg, #4CAF50, #2E7D32);
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 8px;
                    margin-top: 10px;
                    cursor: pointer;
                ">
                    Show All Products
                </button>
            </div>
        `;
        return;
    }
    
    container.innerHTML = '';
    filteredProducts.forEach((product, index) => {
        renderProduct(product, index);
    });
    
    console.log(`üîç Found ${filteredProducts.length} products for "${searchTerm}"`);
}
        // ==================== CART FUNCTIONS ====================
function addToCart(productId) {
    const quantity = selectedQuantities[productId];
    
    if (!quantity || quantity <= 0) {
        showNotification('Please select quantity first', 'error');
        return;
    }
    
    // Find product
    let product;
    for (const cat in PRODUCTS) {
        product = PRODUCTS[cat].find(p => (p._id === productId || p.id === productId));
        if (product) break;
    }
    
    if (!product) {
        showNotification('Product not found', 'error');
        return;
    }
    
    // Check stock
    if ((product.stock || 0) < quantity) {
        showNotification(`Only ${product.stock} ${product.unit} available`, 'error');
        return;
    }
    
    // Add to cart
    const existingItem = cart.find(item => item.id === productId);
    if (existingItem) {
        existingItem.quantity += quantity;
    } else {
        cart.push({
            id: productId,
            name: product.name,
            price: product.price,
            quantity: quantity,
            unit: product.unit,
            productId: product._id || product.id
        });
    }
    
    // Update stock (locally)
    product.stock = (product.stock || 0) - quantity;
    
    // Reset selection
    selectedQuantities[productId] = 0;
    document.querySelectorAll(`#qty-${productId} .quantity-option`).forEach(opt => {
        opt.classList.remove('active');
    });
    
    const customInput = document.getElementById(`custom-${productId}`);
    if (customInput) {
        customInput.value = '';
    }
    
    updateCartCount();
    showNotification(`${product.name} added to cart`);
    
    // Refresh product display
    loadCategoryProducts(currentCategory);
}

function updateCartCount() {
    const total = cart.reduce((sum, item) => sum + item.quantity, 0);
    const cartCountElement = document.getElementById('cartCount');
    if (cartCountElement) {
        cartCountElement.textContent = total;
    }
}

function openCart() {
    if (cart.length === 0) {
        showNotification('Your cart is empty');
        return;
    }
    
    renderCartItems();
    document.getElementById('cartModal').style.display = 'flex';
}

function closeCart() {
    document.getElementById('cartModal').style.display = 'none';
}

function renderCartItems() {
    const itemsContainer = document.getElementById('cartItems');
    const cartTotalElement = document.getElementById('cartTotal');
    
    if (!itemsContainer || !cartTotalElement) return;
    
    let subtotal = 0;
    itemsContainer.innerHTML = '';
    
    cart.forEach(item => {
        const total = item.price * item.quantity;
        subtotal += total;
        
        const itemDiv = document.createElement('div');
        itemDiv.style.display = 'flex';
        itemDiv.style.justifyContent = 'space-between';
        itemDiv.style.alignItems = 'center';
        itemDiv.style.padding = '10px 0';
        itemDiv.style.borderBottom = '1px solid #eee';
        
        itemDiv.innerHTML = `
            <div>
                <div style="font-weight: bold;">${item.name}</div>
                <div style="color: #e74c3c; font-size: 14px;">‚Çπ${item.price}/${item.unit} √ó ${item.quantity}</div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button onclick="updateCartItem(${item.id}, -0.1)" style="background: #f0f0f0; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">-</button>
                <span style="min-width: 40px; text-align: center;">${item.quantity}</span>
                <button onclick="updateCartItem(${item.id}, 0.1)" style="background: #f0f0f0; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">+</button>
                <button onclick="removeFromCart(${item.id})" style="background: #e74c3c; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-trash" style="font-size: 12px;"></i>
                </button>
            </div>
        `;
        itemsContainer.appendChild(itemDiv);
    });
    
    const packaging = BUSINESS_INFO.packagingCharge || 10;
    const total = subtotal + packaging;
    
    cartTotalElement.innerHTML = `
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span>Subtotal:</span>
            <span>‚Çπ${subtotal.toFixed(2)}</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span>Packaging Charge:</span>
            <span>‚Çπ${packaging}</span>
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
            <span>Total:</span>
            <span>‚Çπ${total.toFixed(2)}</span>
        </div>
    `;
}

function updateCartItem(productId, change) {
    const item = cart.find(item => item.id === productId);
    if (!item) return;
    
    // Update quantity
    item.quantity = Math.max(0.1, item.quantity + change);
    
    if (item.quantity <= 0.1) {
        // Remove item if quantity is too low
        cart = cart.filter(item => item.id !== productId);
    }
    
    updateCartCount();
    
    // Update stock in products
    for (const cat in PRODUCTS) {
        const product = PRODUCTS[cat].find(p => (p._id === productId || p.id === productId));
        if (product) {
            if (change < 0) {
                product.stock = (product.stock || 0) + Math.abs(change);
            } else if (change > 0 && (product.stock || 0) >= change) {
                product.stock = (product.stock || 0) - change;
            }
            break;
        }
    }
    
    if (cart.length === 0) {
        closeCart();
    } else {
        renderCartItems();
    }
    
    // Refresh products display
    loadCategoryProducts(currentCategory);
}

function removeFromCart(productId) {
    // Find the item to restore stock
    const item = cart.find(item => item.id === productId);
    if (item) {
        // Restore stock
        for (const cat in PRODUCTS) {
            const product = PRODUCTS[cat].find(p => (p._id === productId || p.id === productId));
            if (product) {
                product.stock = (product.stock || 0) + item.quantity;
                break;
            }
        }
    }
    
    // Remove from cart
    cart = cart.filter(item => item.id !== productId);
    
    updateCartCount();
    
    if (cart.length === 0) {
        closeCart();
    } else {
        renderCartItems();
    }
    
    // Refresh products display
    loadCategoryProducts(currentCategory);
    
    showNotification('Item removed from cart');
}

// ==================== CHECKOUT FUNCTIONS ====================
function checkBusinessHours() {
    const now = new Date();
    const currentHour = now.getHours();
    
    // Store hours: 10 AM to 10 PM
    if (currentHour >= 10 && currentHour < 22) {
        openCheckoutModal();
    } else {
        document.getElementById('businessHoursModal').style.display = 'flex';
    }
}

function openCheckoutModal() {
    if (cart.length === 0) {
        showNotification('Your cart is empty');
        return;
    }
    
    renderBillingSummary();
    document.getElementById('checkoutModal').style.display = 'flex';
    closeCart();
}

function closeCheckoutModal() {
    document.getElementById('checkoutModal').style.display = 'none';
}

function closeBusinessHoursModal() {
    document.getElementById('businessHoursModal').style.display = 'none';
}

function renderBillingSummary() {
    const billingSummary = document.getElementById('billingSummary');
    if (!billingSummary) return;
    
    let subtotal = 0;
    let itemsHTML = '';
    
    cart.forEach(item => {
        const total = item.price * item.quantity;
        subtotal += total;
        itemsHTML += `
            <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                <span>${item.name} (${item.quantity}${item.unit})</span>
                <span>‚Çπ${total.toFixed(2)}</span>
            </div>
        `;
    });
    
    const packaging = BUSINESS_INFO.packagingCharge || 10;
    const total = subtotal + packaging;
    const advance = total * 0.5;
    
    billingSummary.innerHTML = `
        <h3 style="margin-bottom: 15px;">Order Summary</h3>
        ${itemsHTML}
        <div style="display: flex; justify-content: space-between; padding: 5px 0; border-top: 1px solid #ddd; margin-top: 10px;">
            <span>Subtotal:</span>
            <span>‚Çπ${subtotal.toFixed(2)}</span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
            <span>Packaging Charge:</span>
            <span>‚Çπ${packaging}</span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 5px 0; font-weight: bold; font-size: 16px;">
            <span>Total Amount:</span>
            <span>‚Çπ${total.toFixed(2)}</span>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 5px 0; color: #e74c3c; font-weight: bold; margin-top: 10px;">
            <span>50% Advance Payment:</span>
            <span>‚Çπ${advance.toFixed(2)}</span>
        </div>
    `;
}

function validateAndCheckout() {
    const name = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    
    if (!name || !phone) {
        showNotification('Please fill all required fields', 'error');
        return;
    }
    
    if (phone.length < 10) {
        showNotification('Please enter a valid phone number', 'error');
        return;
    }
    
    processCheckout(name, phone);
}

function processCheckout(name, phone) {
    let subtotal = 0;
    let message = `*Sabji Haat - New Order*\n\n`;
    message += `*Order Date:* ${new Date().toLocaleDateString('en-IN')}\n`;
    message += `*Customer:* ${name}\n`;
    message += `*Phone:* ${phone}\n\n`;
    message += `*Order Items:*\n`;
    
    cart.forEach(item => {
        const total = item.price * item.quantity;
        subtotal += total;
        message += `‚Ä¢ ${item.name} - ${item.quantity}${item.unit} √ó ‚Çπ${item.price} = ‚Çπ${total.toFixed(2)}\n`;
    });
    
    const packaging = BUSINESS_INFO.packagingCharge || 10;
    const total = subtotal + packaging;
    const advance = total * 0.5;
    
    message += `\n*Order Summary:*\n`;
    message += `Subtotal: ‚Çπ${subtotal.toFixed(2)}\n`;
    message += `Packaging: ‚Çπ${packaging}\n`;
    message += `*Total: ‚Çπ${total.toFixed(2)}*\n`;
    message += `*Advance (50%): ‚Çπ${advance.toFixed(2)}*\n\n`;
    message += `*Payment Instructions:*\n`;
    message += `1. Send ‚Çπ${advance.toFixed(2)} advance payment\n`;
    message += `2. Payment to: ${BUSINESS_INFO.phone}\n`;
    message += `3. Send payment screenshot\n`;
    message += `4. Collect from store with remaining payment\n\n`;
    message += `*Pickup Address:*\n`;
    message += `${BUSINESS_INFO.address}\n\n`;
    message += `Thank you for choosing Sabji Haat! ü•¶`;
    
    const encoded = encodeURIComponent(message);
    window.open(`https://wa.me/${BUSINESS_INFO.phone.replace('+', '')}?text=${encoded}`, '_blank');
    
    // Clear cart
    cart = [];
    updateCartCount();
    closeCheckoutModal();
    
    showNotification('Order sent to WhatsApp! Please send payment screenshot.', 'success');
    
    // Refresh products
    loadCategoryProducts(currentCategory);
}

// ==================== PAGE NAVIGATION ====================
function showAboutPage() {
    document.querySelector('.main-app').style.display = 'none';
    document.getElementById('aboutPage').style.display = 'block';
    window.scrollTo(0, 0);
}

function showHomePage() {
    document.getElementById('aboutPage').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'none';
    document.querySelector('.main-app').style.display = 'block';
    window.scrollTo(0, 0);
}
        // ==================== ADMIN FUNCTIONS ====================
function setupAdminAccess() {
    const homeButton = document.getElementById('homeButton');
    if (!homeButton) return;
    
    let pressTimer;
    let clickCount = 0;
    let clickTimer;
    let isLongPress = false;
    
    // Single click handler - show home page
    homeButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        // If it was a long press, don't handle click
        if (isLongPress) {
            isLongPress = false;
            return;
        }
        
        clickCount++;
        
        if (clickTimer) {
            clearTimeout(clickTimer);
        }
        
        clickTimer = setTimeout(() => {
            if (clickCount === 1) {
                // Single click - show home page
                showHomePage();
            } else if (clickCount >= 3) {
                // Triple click - open admin
                openAdminLogin();
            }
            clickCount = 0;
        }, 300);
    });
    
    // Long press handler (10 seconds) for admin login
    homeButton.addEventListener('mousedown', function(e) {
        e.preventDefault();
        console.log('Mouse down - starting 10 second timer...');
        
        pressTimer = setTimeout(() => {
            console.log('‚úÖ Long press detected (10 seconds)! Opening admin...');
            isLongPress = true;
            openAdminLogin();
        }, 10000);
    });
    
    homeButton.addEventListener('mouseup', function(e) {
        e.preventDefault();
        console.log('Mouse up - clearing timer');
        clearTimeout(pressTimer);
    });
    
    homeButton.addEventListener('mouseleave', function(e) {
        e.preventDefault();
        console.log('Mouse left - clearing timer');
        clearTimeout(pressTimer);
    });
    
    // Touch devices
    homeButton.addEventListener('touchstart', function(e) {
        e.preventDefault();
        console.log('Touch start - starting 10 second timer...');
        
        pressTimer = setTimeout(() => {
            console.log('‚úÖ Touch long press detected (10 seconds)! Opening admin...');
            isLongPress = true;
            openAdminLogin();
        }, 10000);
    });
    
    homeButton.addEventListener('touchend', function(e) {
        e.preventDefault();
        console.log('Touch end - clearing timer');
        clearTimeout(pressTimer);
    });
    
    homeButton.addEventListener('touchcancel', function(e) {
        e.preventDefault();
        console.log('Touch cancel - clearing timer');
        clearTimeout(pressTimer);
    });
}

function openAdminLogin() {
    console.log('üéØ Admin login modal opening...');
    document.getElementById('adminLoginModal').style.display = 'flex';
}

function closeAdminLogin() {
    document.getElementById('adminLoginModal').style.display = 'none';
    const usernameInput = document.getElementById('adminUsername');
    const passwordInput = document.getElementById('adminPassword');
    
    if (usernameInput) usernameInput.value = '';
    if (passwordInput) passwordInput.value = '';
}

async function adminLogin(event) {
    if (event) event.preventDefault();
    
    const username = document.getElementById('adminUsername').value;
    const password = document.getElementById('adminPassword').value;
    
    if (!username || !password) {
        showNotification('Please enter credentials', 'error');
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/admin/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                adminToken = data.data.token;
                localStorage.setItem('adminToken', adminToken);
                showAdminPanel();
                showNotification('Admin login successful');
            } else {
                showNotification(data.error || 'Login failed', 'error');
            }
        } else {
            // Fallback for testing
            if (username === 'admin' && password === 'sabjihaat2025') {
                adminToken = 'test-token';
                showAdminPanel();
                showNotification('Admin login successful (offline mode)');
            } else {
                showNotification('Invalid credentials', 'error');
            }
        }
    } catch (error) {
        console.error('Login error:', error);
        // Fallback for offline testing
        if (username === 'admin' && password === 'sabjihaat2025') {
            adminToken = 'offline-token';
            showAdminPanel();
            showNotification('Admin login successful (offline mode)');
        } else {
            showNotification('Login failed. Check connection.', 'error');
        }
    }
}

function showAdminPanel() {
    closeAdminLogin();
    document.querySelector('.main-app').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'block';
    loadAdminProducts();
    window.scrollTo(0, 0);
}

function adminLogout() {
    adminToken = null;
    localStorage.removeItem('adminToken');
    showHomePage();
    showNotification('Logged out successfully');
}

function switchAdminTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.admin-tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Remove active from all buttons
    document.querySelectorAll('.admin-tab').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(`${tabName}Tab`).classList.add('active');
    
    // Add active to clicked button
    if (event && event.target) {
        event.target.classList.add('active');
    }
    
    // Load data if needed
    if (tabName === 'stock') {
        loadStockManagement();
    } else if (tabName === 'settings') {
        loadAdminSettings();
    }
}

async function loadAdminProducts() {
    try {
        const response = await fetch(`${API_BASE_URL}/api/products`);
        let products = [];
        
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                products = data.data;
            }
        }
        
        if (products.length === 0) {
            products = Object.values(PRODUCTS).flat();
        }
        
        const container = document.getElementById('adminProductList');
        if (!container) return;
        
        container.innerHTML = '';
        
        products.forEach(product => {
            const div = document.createElement('div');
            div.className = 'admin-product-item';
            div.style.cssText = `
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                border-bottom: 1px solid #eee;
                background: #f9f9f9;
                margin-bottom: 8px;
                border-radius: 5px;
            `;
            
            div.innerHTML = `
                <div>
                    <div style="font-weight: bold;">${product.name}</div>
                    <div style="font-size: 12px; color: #666;">‚Çπ${product.price}/${product.unit} | ${product.category} | Stock: ${product.stock || 0}</div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button onclick="editProduct('${product._id || product.id}')" style="background: #3498db; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Edit</button>
                    <button onclick="deleteProduct('${product._id || product.id}')" style="background: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Delete</button>
                </div>
            `;
            container.appendChild(div);
        });
    } catch (error) {
        console.error('Error loading admin products:', error);
        showNotification('Error loading products', 'error');
    }
}

function loadStockManagement() {
    const container = document.getElementById('stockList');
    if (!container) return;
    
    const allProducts = Object.values(PRODUCTS).flat();
    
    container.innerHTML = '';
    allProducts.forEach(product => {
        const div = document.createElement('div');
        div.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            background: #f9f9f9;
            margin-bottom: 8px;
            border-radius: 5px;
        `;
        
        const isOutOfStock = (product.stock || 0) <= 0;
        
        div.innerHTML = `
            <div>
                <div style="font-weight: bold;">${product.name}</div>
                <div style="font-size: 12px; color: #666;">${product.category} | ‚Çπ${product.price}/${product.unit}</div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 12px; padding: 3px 8px; border-radius: 10px; background: ${isOutOfStock ? '#ffebee' : '#e8f5e9'}; color: ${isOutOfStock ? '#c62828' : '#2e7d32'}">
                    ${isOutOfStock ? 'Out of Stock' : 'In Stock'}
                </span>
                <input type="number" id="stock-${product._id || product.id}" value="${product.stock || 0}" style="width: 60px; padding: 5px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                <button onclick="updateStock('${product._id || product.id}')" style="background: #2ecc71; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Update</button>
            </div>
        `;
        container.appendChild(div);
    });
}

function loadAdminSettings() {
    const packagingChargeInput = document.getElementById('packagingCharge');
    if (packagingChargeInput) {
        packagingChargeInput.value = BUSINESS_INFO.packagingCharge || 10;
    }
}

async function updateStock(productId) {
    const newStock = parseInt(document.getElementById(`stock-${productId}`).value) || 0;
    
    try {
        if (adminToken) {
            const response = await fetch(`${API_BASE_URL}/api/products/${productId}/stock`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${adminToken}`
                },
                body: JSON.stringify({ stock: newStock })
            });
            
            if (!response.ok) {
                throw new Error('Failed to update stock on server');
            }
        }
        
        // Update locally
        for (const cat in PRODUCTS) {
            const productIndex = PRODUCTS[cat].findIndex(p => (p._id === productId || p.id === productId));
            if (productIndex !== -1) {
                PRODUCTS[cat][productIndex].stock = newStock;
                break;
            }
        }
        
        showNotification('Stock updated successfully');
        loadCategoryProducts(currentCategory);
    } catch (error) {
        console.error('Error updating stock:', error);
        showNotification('Error updating stock', 'error');
    }
}

async function saveSettings() {
    const charge = parseInt(document.getElementById('packagingCharge').value) || 10;
    BUSINESS_INFO.packagingCharge = charge;
    
    try {
        if (adminToken) {
            const response = await fetch(`${API_BASE_URL}/api/business-info`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${adminToken}`
                },
                body: JSON.stringify({ packagingCharge: charge })
            });
            
            if (response.ok) {
                showNotification('Settings saved successfully');
            } else {
                throw new Error('Failed to save settings');
            }
        } else {
            showNotification('Settings saved locally', 'info');
        }
    } catch (error) {
        console.error('Error saving settings:', error);
        showNotification('Settings saved locally', 'info');
    }
}

function showAddProductForm() {
    const container = document.getElementById('adminProductList');
    if (!container) return;
    
    container.innerHTML = `
        <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-bottom: 15px;">‚ûï Add New Product</h3>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Product Name *</label>
                <input type="text" id="newProductName" placeholder="e.g., Potato" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Price (‚Çπ) *</label>
                <input type="number" id="newProductPrice" placeholder="e.g., 30" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Unit *</label>
                <select id="newProductUnit" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="kg">kg</option>
                    <option value="piece">Piece</option>
                    <option value="bunch">Bunch</option>
                    <option value="packet">Packet</option>
                    <option value="liter">Liter</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Category *</label>
                <select id="newProductCategory" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="indian">Indian</option>
                    <option value="exotic">Exotic</option>
                    <option value="leafy">Leafy</option>
                    <option value="others">Others</option>
                    <option value="puja">Puja Needs</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Initial Stock *</label>
                <input type="number" id="newProductStock" value="10" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">Product Image URL</label>
                <input type="text" id="newProductImage" placeholder="https://example.com/image.jpg" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <p style="font-size: 12px; color: #666; margin-top: 5px;">
                    Leave empty for default image, or paste image URL
                </p>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="saveNewProduct()" style="
                    background: linear-gradient(135deg, #2ecc71, #27ae60);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                    flex: 1;
                ">
                    <i class="fas fa-save"></i> Save Product
                </button>
                
                <button onclick="cancelAddProduct()" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    ` + container.innerHTML;
    
    // Scroll to form
    container.scrollIntoView({ behavior: 'smooth' });
}

function cancelAddProduct() {
    loadAdminProducts();
}

async function saveNewProduct() {
    const name = document.getElementById('newProductName').value.trim();
    const price = document.getElementById('newProductPrice').value;
    const unit = document.getElementById('newProductUnit').value;
    const category = document.getElementById('newProductCategory').value;
    const stock = document.getElementById('newProductStock').value;
    let image = document.getElementById('newProductImage').value.trim();
    
    // Validation
    if (!name || !price || !unit || !category) {
        showNotification('Please fill all required fields', 'error');
        return;
    }
    
    if (price <= 0) {
        showNotification('Price must be greater than 0', 'error');
        return;
    }
    
    // Default image if not provided
    if (!image) {
        image = 'https://images.unsplash.com/photo-1542838132-92c53300491e?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80';
    }
    
    try {
        const response = await fetch(`${API_BASE_URL}/api/products`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${adminToken}`
            },
            body: JSON.stringify({
                name,
                price: parseFloat(price),
                unit,
                category,
                stock: parseInt(stock) || 0,
                image
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('Product added successfully!');
            loadAdminProducts();
            
            // Also update local products
            const newProduct = data.data;
            if (PRODUCTS[category]) {
                PRODUCTS[category].push({
                    _id: newProduct._id,
                    id: newProduct._id,
                    name: newProduct.name,
                    price: newProduct.price,
                    unit: newProduct.unit,
                    stock: newProduct.stock,
                    category: newProduct.category,
                    image: newProduct.image
                });
            }
            
            // Refresh current category view if needed
            if (currentCategory === category) {
                loadCategoryProducts(category);
            }
        } else {
            showNotification(data.error || 'Failed to add product', 'error');
        }
    } catch (error) {
        console.error('Error adding product:', error);
        showNotification('Network error. Product saved locally.', 'info');
        
             // Add to local products for offline mode
        const newId = Date.now();
        if (PRODUCTS[category]) {
            PRODUCTS[category].push({
                _id: newId,
                id: newId,
                name,
                price: parseFloat(price),
                unit,
                stock: parseInt(stock) || 0,
                category,
                image
            });
            
            showNotification('Product added locally (offline mode)');
            loadAdminProducts();
            
            if (currentCategory === category) {
                loadCategoryProducts(category);
            }
        }
    }
}

function editProduct(productId) {
    // Find product
    let product;
    for (const cat in PRODUCTS) {
        product = PRODUCTS[cat].find(p => (p._id === productId || p.id === productId));
        if (product) break;
    }
    
    if (!product) {
        showNotification('Product not found', 'error');
        return;
    }
    
    const container = document.getElementById('adminProductList');
    if (!container) return;
    
    container.innerHTML = `
        <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-bottom: 15px;">‚úèÔ∏è Edit Product</h3>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Product Name *</label>
                <input type="text" id="editProductName" value="${product.name}" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Price (‚Çπ) *</label>
                <input type="number" id="editProductPrice" value="${product.price}" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Unit *</label>
                <select id="editProductUnit" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="kg" ${product.unit === 'kg' ? 'selected' : ''}>kg</option>
                    <option value="piece" ${product.unit === 'piece' ? 'selected' : ''}>Piece</option>
                    <option value="bunch" ${product.unit === 'bunch' ? 'selected' : ''}>Bunch</option>
                    <option value="packet" ${product.unit === 'packet' ? 'selected' : ''}>Packet</option>
                    <option value="liter" ${product.unit === 'liter' ? 'selected' : ''}>Liter</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Category *</label>
                <select id="editProductCategory" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="indian" ${product.category === 'indian' ? 'selected' : ''}>Indian</option>
                    <option value="exotic" ${product.category === 'exotic' ? 'selected' : ''}>Exotic</option>
                    <option value="leafy" ${product.category === 'leafy' ? 'selected' : ''}>Leafy</option>
                    <option value="others" ${product.category === 'others' ? 'selected' : ''}>Others</option>
                    <option value="puja" ${product.category === 'puja' ? 'selected' : ''}>Puja Needs</option>
                </select>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label style="display: block; margin-bottom: 5px;">Stock *</label>
                <input type="number" id="editProductStock" value="${product.stock || 0}" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px;">Product Image URL</label>
                <input type="text" id="editProductImage" value="${product.image}" 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <p style="font-size: 12px; color: #666; margin-top: 5px;">
                    Current image URL
                </p>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="updateProduct('${productId}')" style="
                    background: linear-gradient(135deg, #3498db, #2980b9);
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                    flex: 1;
                ">
                    <i class="fas fa-save"></i> Update Product
                </button>
                
                <button onclick="cancelAddProduct()" style="
                    background: #95a5a6;
                    color: white;
                    border: none;
                    padding: 12px 20px;
                    border-radius: 8px;
                    cursor: pointer;
                ">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    ` + container.innerHTML;
    
    // Scroll to form
    container.scrollIntoView({ behavior: 'smooth' });
}

async function updateProduct(productId) {
    const name = document.getElementById('editProductName').value.trim();
    const price = document.getElementById('editProductPrice').value;
    const unit = document.getElementById('editProductUnit').value;
    const category = document.getElementById('editProductCategory').value;
    const stock = document.getElementById('editProductStock').value;
    const image = document.getElementById('editProductImage').value.trim();
    
    // Validation
    if (!name || !price || !unit || !category || !image) {
        showNotification('Please fill all required fields', 'error');
        return;
    }
    
    if (price <= 0) {
        showNotification('Price must be greater than 0', 'error');
        return;
    }
    
    try {
        if (adminToken) {
            const response = await fetch(`${API_BASE_URL}/api/products/${productId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${adminToken}`
                },
                body: JSON.stringify({
                    name,
                    price: parseFloat(price),
                    unit,
                    category,
                    stock: parseInt(stock) || 0,
                    image
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Product updated successfully!');
                loadAdminProducts();
                
                // Update local products
                for (const cat in PRODUCTS) {
                    const productIndex = PRODUCTS[cat].findIndex(p => (p._id === productId || p.id === productId));
                    if (productIndex !== -1) {
                        PRODUCTS[cat][productIndex] = {
                            ...PRODUCTS[cat][productIndex],
                            name,
                            price: parseFloat(price),
                            unit,
                            category,
                            stock: parseInt(stock) || 0,
                            image
                        };
                        break;
                    }
                }
                
                // Refresh current category view if needed
                if (currentCategory === category) {
                    loadCategoryProducts(category);
                }
            } else {
                showNotification(data.error || 'Failed to update product', 'error');
            }
        } else {
            showNotification('Please login first', 'error');
        }
    } catch (error) {
        console.error('Error updating product:', error);
        showNotification('Error updating product', 'error');
    }
}

async function deleteProduct(productId) {
    if (!confirm('Are you sure you want to delete this product?')) {
        return;
    }
    
    try {
        if (adminToken) {
            const response = await fetch(`${API_BASE_URL}/api/products/${productId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${adminToken}`
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                showNotification('Product deleted successfully!');
                
                // Remove from local products
                for (const cat in PRODUCTS) {
                    const productIndex = PRODUCTS[cat].findIndex(p => (p._id === productId || p.id === productId));
                    if (productIndex !== -1) {
                        PRODUCTS[cat].splice(productIndex, 1);
                        break;
                    }
                }
                
                loadAdminProducts();
                
                // Refresh current category view
                loadCategoryProducts(currentCategory);
            } else {
                showNotification(data.error || 'Failed to delete product', 'error');
            }
        } else {
            showNotification('Please login first', 'error');
        }
    } catch (error) {
        console.error('Error deleting product:', error);
        showNotification('Error deleting product', 'error');
    }
}

// ==================== UTILITY FUNCTIONS ====================
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    if (!notification) return;
    
    notification.textContent = message;
    notification.className = `notification ${type === 'error' ? 'error' : ''}`;
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}

// ==================== SOCIAL FUNCTIONS ====================
function openWhatsApp() {
    window.open(`https://wa.me/${BUSINESS_INFO.phone.replace('+', '')}`, '_blank');
}

function openFacebook() {
    window.open(BUSINESS_INFO.facebook, '_blank');
}

function openInstagram() {
    window.open(BUSINESS_INFO.instagram, '_blank');
}

function openGoogleReview() {
    window.open(BUSINESS_INFO.googleReview, '_blank');
}

function openServiceWhatsApp(service) {
    const message = `Hello Sabji Haat! I'm interested in ${service} service.`;
    window.open(`https://wa.me/${BUSINESS_INFO.phone.replace('+', '')}?text=${encodeURIComponent(message)}`, '_blank');
}

// ==================== GLOBAL FUNCTIONS ====================
// These functions are called from HTML onclick attributes
window.loadCategory = loadCategory;
window.slideServices = slideServices;
window.slideReviews = slideReviews;
window.selectQuantity = selectQuantity;
window.setCustomQuantity = setCustomQuantity;
window.addToCart = addToCart;
window.openCart = openCart;
window.closeCart = closeCart;
window.updateCartItem = updateCartItem;
window.removeFromCart = removeFromCart;
window.checkBusinessHours = checkBusinessHours;
window.closeCheckoutModal = closeCheckoutModal;
window.closeBusinessHoursModal = closeBusinessHoursModal;
window.validateAndCheckout = validateAndCheckout;
window.showAboutPage = showAboutPage;
window.showHomePage = showHomePage;
window.openAdminLogin = openAdminLogin;
window.closeAdminLogin = closeAdminLogin;
window.adminLogin = adminLogin;
window.showAdminPanel = showAdminPanel;
window.adminLogout = adminLogout;
window.switchAdminTab = switchAdminTab;
window.loadStockManagement = loadStockManagement;
window.updateStock = updateStock;
window.saveSettings = saveSettings;
window.showAddProductForm = showAddProductForm;
window.cancelAddProduct = cancelAddProduct;
window.saveNewProduct = saveNewProduct;
window.editProduct = editProduct;
window.updateProduct = updateProduct;
window.deleteProduct = deleteProduct;
window.openWhatsApp = openWhatsApp;
window.openFacebook = openFacebook;
window.openInstagram = openInstagram;
window.openGoogleReview = openGoogleReview;
window.openServiceWhatsApp = openServiceWhatsApp;

console.log("‚úÖ JavaScript loaded successfully");
        </script>
    </html>
